#!/usr/bin/env python3
"""
ç®€åŒ–ç‰ˆ Work Memo å‘½ä»¤æ¥å£

ç”¨æ³•: /memo <è‡ªç„¶è¯­è¨€æè¿°>

ç¤ºä¾‹:
  /memo ç´§æ€¥ä¼šè®®æ˜å¤© #work @office
  /memo å®Œæˆé¡¹ç›®æŠ¥å‘Š
  /memo ä¿®å¤ç™»å½•bug
"""

import sys
from pathlib import Path

# è·å–è„šæœ¬æ‰€åœ¨ç›®å½•
SCRIPT_DIR = Path(__file__).resolve().parent
MEMO_COMMAND_PATH = SCRIPT_DIR / "skills" / "scripts" / "memo_command.py"


def record_memo(description: str) -> int:
    """è®°å½•å·¥ä½œå¤‡å¿˜å½•"""
    if not MEMO_COMMAND_PATH.exists():
        print(f"âŒ é”™è¯¯ï¼šæ‰¾ä¸åˆ° memo_command.py: {MEMO_COMMAND_PATH}")
        return 1

    import subprocess
    try:
        result = subprocess.run(
            [sys.executable, str(MEMO_COMMAND_PATH), description],
            capture_output=True,
            text=True,
            timeout=10
        )
        print(result.stdout, end='')
        if result.stderr:
            print(result.stderr, file=sys.stderr)
        return result.returncode
    except subprocess.TimeoutExpired:
        print("âŒ å‘½ä»¤æ‰§è¡Œè¶…æ—¶", file=sys.stderr)
        return 1
    except Exception as e:
        print(f"âŒ é”™è¯¯: {e}", file=sys.stderr)
        return 1


def show_help():
    """æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"""
    help_text = """
ğŸ“ å·¥ä½œå¤‡å¿˜å½•å‘½ä»¤

ä½¿ç”¨æ–¹å¼: /memo <è‡ªç„¶è¯­è¨€æè¿°>

æ”¯æŒçš„è‡ªç„¶è¯­è¨€è¯­æ³•:
  - æ ‡ç­¾: #work, #urgent, #bug ç­‰
  - ä¸Šä¸‹æ–‡: @office, @home, @phone ç­‰
  - æ—¶é—´: æ˜å¤©, ä¸‹å‘¨ä¸‰, ä»Šå¤©ç­‰
  - ä¼˜å…ˆçº§: ç´§æ€¥, é‡è¦, éå¸¸ç´§æ€¥ ç­‰

ç¤ºä¾‹:
  /memo ç´§æ€¥ä¼šè®®æ˜å¤© #work @office
  /memo å®Œæˆé¡¹ç›®æŠ¥å‘Š
  /memo ä¿®å¤ç™»å½•bug #urgent
  /memo å›¢é˜Ÿä¾‹ä¼š #meeting
  /memo é‡è¦ç”µè¯æ˜å¤© @phone

é«˜çº§ç”¨æ³•:
  /memo "ä»»åŠ¡æè¿°" --urgency 5 --importance 4
  /memo "ä»»åŠ¡æè¿°" --type bugfix --tags urgent

å¸®åŠ©:
  /memo help
"""
    print(help_text)
    return 0


def main():
    # æ²¡æœ‰å‚æ•°ï¼Œæ˜¾ç¤ºå¸®åŠ©
    if len(sys.argv) < 2:
        return show_help()

    # æ£€æŸ¥æ˜¯å¦æ˜¯å¸®åŠ©å‘½ä»¤
    if sys.argv[1].lower() in ['help', '-h', '--help']:
        return show_help()

    # è·å–å®Œæ•´çš„è‡ªç„¶è¯­è¨€æè¿°
    description = ' '.join(sys.argv[1:])

    # è®°å½•å¤‡å¿˜å½•
    return record_memo(description)


if __name__ == '__main__':
    sys.exit(main())
