---
name: html-presentation-beautifier
description: "将文档、数据、结论等信息转化为通俗连贯、明确清晰的 HTML 格式幻灯片。使用 McKinsey 风格设计系统，严格遵循配色方案和层次结构，通过丰富的图表形式可视化展示结论、概念和数据。不修改原文档中的结论、概念、名称等信息，仅进行展示性美化输出。"
---

# HTML Presentation Beautifier

将文档、数据、结论等信息转化为通俗连贯、明确清晰的 HTML 格式幻灯片。使用 McKinsey 风格设计系统，严格遵循配色方案和层次结构，通过丰富的图表形式可视化展示结论、概念和数据。

**核心原则**：不修改原文档中的结论、概念、名称等信息，仅进行展示性美化输出。

## Process Overview

本技能遵循结构化的多阶段处理流程：

1. **阶段 1：文档解析** - 提取并理解源文档结构
2. **阶段 2：内容结构化** - 将内容组织为幻灯片友好的格式
3. **阶段 3：设计与布局** - 应用 McKinsey 风格设计系统
4. **阶段 4：HTML 生成** - 生成交互式 HTML 演示文稿

## Design System (McKinsey/BCG 风格)

### 色彩方案

| 颜色类型 | 色值 | 用途 |
|------------|----------|-------|
| 主背景色 | `#FFFFFF` | 幻灯片背景 |
| 标题栏背景 | `#000000` | 标题栏 |
| 主强调色 | `#F85d42` | 关键高亮、行动号召 |
| 次强调色 | `#74788d` | 辅助文本 |
| 深蓝色 | `#556EE6` | 图表、数据点 |
| 绿色 | `#34c38f` | 成功指标 |
| 蓝色 | `#50a5f1` | 中性强调 |
| 黄色 | `#f1b44c` | 警告、注意事项 |

### 排版规范

- **标题**：大号（48-64px），粗体，黑色（`#000000`）
- **副标题**：中号（28-36px），粗体，强调色（`#F85d42` 或 `#74788d`）
- **正文**：常规（16-20px），常规字重，深灰色（`#333333`）
- **强调文本**：常规字重 + 强调色或粗体
- **图表标签**：小号（12-14px），清晰易读

### 设计原则

- **现代商务风格**：简洁、专业、最小化杂乱元素
- **视觉层次**：标题、副标题、正文之间清晰区分
- **一致性**：所有幻灯片采用统一的设计语言
- **数据驱动**：使用图表和可视化展示定量信息
- **专业品质**：达到 McKinsey/BCG 咨询演示文稿水准

## 阶段 1：文档解析

**目标**：提取并分析源文档，理解内容结构、数据点和结论。

**前置条件**：
- 已提供源文档（Markdown、文本或结构化格式）
- 未对原始内容进行任何修改

**检查清单**：
- [ ] 文档格式已识别且可读
- [ ] 文档结构已解析（标题、列表、数据表格、结论）
- [ ] 关键数据点和指标已提取
- [ ] 主要结论和见解已识别
- [ ] 内容层次已映射（H1 → H2 → H3）

**步骤**：
1. 完整阅读源文档，不做任何修改
2. 识别文档类型（报告、分析、研究等）
3. 提取结构化元素：
   - 标题和副标题
   - 项目符号和编号列表
   - 数据表格和数值数据
   - 关键结论和建议
4. 映射内容层次：主题 → 子主题 → 支撑细节
5. 识别适合图表/图形展示的定量数据

**退出标准**：文档已完全解析，内容结构已映射，数据点已编目。

**强制要求 - 开始前必读**：在开始阶段 1 之前，完整阅读 [`references/parsing-guidelines.md`](references/parsing-guidelines.md)。

## 阶段 2：内容结构化

**目标**：将解析的内容转换为幻灯片友好的格式，同时保留所有原始含义和结论。

**前置条件**：
- 阶段 1 已完成，内容结构已映射
- 所有关键数据点和结论已识别

**检查清单**：
- [ ] 内容已按逻辑幻灯片主题分组
- [ ] 每张幻灯片具有明确的目的和信息
- [ ] 数据点已分配给适当的可视化方式
- [ ] 结论和建议完全保留
- [ ] 无内容丢失或误解

**步骤**：
1. 按主题分组内容（例如：执行摘要、数据分析、结论）
2. 为每个主题创建幻灯片大纲：
   - 从主标题提取幻灯片标题
   - 从支撑内容提取关键点
   - 用于图表/可视化的数据
   - 保留确切的结论和建议
3. 确定所需的幻灯片类型：
   - **标题幻灯片**：文档标题和关键背景
   - **执行摘要**：前 3-5 个结论
   - **数据幻灯片**：带支撑分析的图表
   - **详情幻灯片**：支撑证据和方法论
   - **结论幻灯片**：最终建议和下一步
4. 为数据分配可视化类型：
   - 柱状图：跨类别比较
   - 折线图：随时间变化的趋势
   - 饼图：比例和百分比
   - 表格：详细的数据细分
5. 验证所有原始结论都存在且未修改

**退出标准**：所有内容已组织成具有可视化分配的幻灯片结构，零内容丢失。

## 阶段 3：设计与布局

**目标**：将 McKinsey 风格设计系统应用于结构化内容，创建专业演示文稿。

**前置条件**：
- 阶段 2 已完成，幻灯片结构已定义
- 所有数据可视化已分配

**检查清单**：
- [ ] 为每种内容类型选择了幻灯片布局
- [ ] 一致应用了配色方案
- [ ] 建立了排版层次
- [ ] 优化了留白和间距
- [ ] 图表和视觉元素设计专业

**步骤**：
1. 为每张幻灯片选择适当的布局：
   - **全宽标题**：用于章节标题
   - **两列布局**：用于比较幻灯片
   - **三列布局**：用于多个数据点
   - **中心聚焦**：用于关键信息
   - **图表 + 文本**：用于数据幻灯片
2. 应用配色方案：
   - 所有幻灯片使用白色背景
   - 黑色标题栏配白色文字
   - 橙色强调（`#F85d42`）用于关键指标和行动号召
   - 灰色（`#74788d`）用于次要文本
   - 从调色板选择图表颜色（蓝色、绿色、黄色）以增加多样性
3. 设置排版：
   - 标题：48-64px 粗体黑色
   - 副标题：28-36px 粗体强调色
   - 正文：16-20px 常规深灰色
   - 图表标签：12-14px 清晰易读
4. 优化间距和布局：
   - 充足的留白（40-60px 边距）
   - 元素间一致的间距（20-30px）
   - 通过大小和字重建立清晰的视觉层次
5. 设计图表和可视化：
   - 简洁、最小的图表设计（无杂乱元素）
   - 清晰的标签和图例
   - 颜色编码以便于解释
   - 图表下方的支撑数据表格

**退出标准**：所有幻灯片已设计，具有一致的 McKinsey 风格品牌、专业布局和优化的排版。

## 阶段 4：HTML 生成

**目标**：生成交互式 HTML 演示文稿文件，包含所有幻灯片、样式和功能。

**前置条件**：
- 阶段 3 已完成，所有幻灯片设计已最终确定
- 所有内容和可视化已就绪

**检查清单**：
- [ ] 已创建包含所有幻灯片的 HTML 结构
- [ ] 已按设计系统应用 CSS 样式
- [ ] 已添加 JavaScript 交互性（导航、图表）
- [ ] 已实现响应式设计
- [ ] 所有内容正确渲染

**步骤**：
1. 创建 HTML 结构：
   - 单页演示文稿格式
   - 导航控件（上一个/下一个按钮、幻灯片计数器）
   - 每张设计幻灯片的幻灯片容器
2. 实现 CSS 样式：
   - 使用 `assets/styles.css` 进行 McKinsey 风格设计
   - 一致应用调色板
   - 设置排版层次
   - 确保不同屏幕尺寸的响应式断点
3. 添加 JavaScript 功能：
   - 幻灯片导航（键盘箭头、按钮）
   - 幻灯片之间的平滑过渡
   - Chart.js 用于交互式数据可视化
   - 全屏演示模式
4. 嵌入所有内容：
   - 从阶段 2 结构精确渲染文本
   - 使用准确数据生成图表
   - 逐字保留所有结论和建议
5. 测试和验证：
   - 所有幻灯片正确渲染
   - 导航流畅工作
   - 图表准确显示
   - 无内容失真或缺失元素

**退出标准**：功能完整的 HTML 演示文稿文件已生成，包含所有幻灯片、交互性和专业设计。

**交付成果**：单文件、自包含的 HTML 演示文稿，包含：
- 内联 CSS（无外部样式表）
- 内联 JavaScript（除 Chart.js CDN 外无外部脚本）
- 一个文档中的所有幻灯片
- 可在任何现代浏览器中打开

## 交互式功能

### 导航
- **按钮**：导航栏中的上一个/下一个按钮
- **键盘**：箭头键（←/→）、空格（下一个）、Escape（退出全屏）
- **幻灯片计数器**：显示当前位置（例如"幻灯片 3/7"）

### 全屏模式
- 右下角的切换按钮（⛶）
- 按 Escape 键退出

### 图表可视化 - 增强的智能选择系统

**多维检测算法**（v4 - 3 层分析）：
- **第 1 层：语义分析**（Apache Superset 模式）- 字段类型检测（时间、分类、地理、层次、财务、绩效）
- **第 2 层：结构推断**（variant-agents 模式）- 数据格式分析（XY、XYZ、范围、矩阵、流向、进度、坐标）
- **第 3 层：基于规则的决策树**（OpenObserve 模式）- 结合两层的 7 优先级逻辑

**可用图表类型**（50+ 种专业可视化）：

**基础图表**：
- **柱状图** - 类别比较
- **条形图/横向条形图** - 长类别名称
- **折线图/线形图** - 时间趋势
- **饼图** - 部分与整体关系（≤5 项）
- **环形图** - 中心聚焦的部分与整体关系

**高级图表**：
- **进度环** - 完成状态
- **仪表盘** - KPI 指标
- **雷达图/蛛网图** - 多维比较
- **漏斗图** - 流程阶段/转化
- **甘特图/横向时间轴** - 项目时间线
- **热点矩阵/热力图** - 密度/强度分布
- **玫瑰图** - 周期性数据模式
- **南丁格尔玫瑰图** - 方向和幅度
- **金字塔图** - 层次结构
- **桑基图** - 阶段间的流向/移动
- **烛台图** - 财务/股票数据
- **子弹图** - 目标与实际对比 + KPI
- **阶梯图** - 离散时间变化
- **箱型图** - 分布和异常值
- **瀑布图** - 顺序加法/减法
- **气泡图** - 三维（x, y, 大小）
- **极坐标弧长图** - 周期性时间模式

**高级商务图表**（新增 - 增强检测）：
- **热点矩阵/热力图** - 二维数据强度 - ✅ 已实现
- **箱型图** - 分布和异常值 - ✅ 已实现
- **甘特图/横向时间轴** - 项目时间线 - ✅ 已实现
- **瀑布图** - 顺序加法/减法 - ✅ 已实现
- **桑基图** - 阶段间流向 - ✅ 已实现
- **波士顿矩阵** - 市场份额与增长 - ✅ 已实现

**专业商务图表**：
- **差异箭头图** - 正/负变化
- **帕累托图** - 80/20 法则分析
- **麦肯锡标签法柱形** - 带标签的柱形比较
- **斜率图** - 两个时间点之间的变化
- **矩阵气泡图** - 位置 + 大小数据
- **马赛克图** - 市场份额构成
- **华夫图** - 网格式部分与整体
- **蝴蝶图** - 发散比较
- **滑珠图** - 沿轴的分布
- **GE-McKinsey 九宫格** - 行业吸引力与业务实力
- **安索夫增长矩阵** - 增长战略选项
- **战略路线图** - 战略举措时间线
- **品牌漏斗** - 品牌指标阶段
- **市场漏斗** - 市场转化阶段
- **竞争四象限** - 竞争定位
- **感知定位图** - 品牌/产品感知
- **泳道图** - 流程责任
- **价值流程图** - 流程增值分析
- **价格敏感度** - 需求与价格
- **Kano 模型图** - 功能满意度
- **蒙特卡洛云** - 概率分布

**概念图表**（无需数值数据）：
- **强调框** - 以视觉显著性突出重点
- **递进图** - 顺序步骤或阶段
- **金字塔** - 层次结构（3-5 层）
- **倒金字塔** - 优先级/漏斗结构
- **三角形** - 三部分关系
- **圆环/循环** - 周期性流程
- **韦恩图** - 集合关系和重叠
- **时间轴** - 顺序事件或里程碑
- **编号列表** - 有序优先级或步骤
- **标注树** - 带分支的中心思想
- **思维导图** - 从中心辐射的想法
- **关系图** - 概念之间的连接
- **流程图** - 带决策点的流程
- **组织架构图** - 层次报告
- **对比图** - 两种状态的比较
- **问题/解决方案** - 问题和解决方案
- **优缺点** - 双方面比较
- **黄金圈法则** - 目的驱动的沟通
- **5W1H** - Who, What, Where, When, Why, How
- **STAR** - Situation, Task, Action, Result（成就框架）

**智能图表选择逻辑**（增强 v4 - 多维分析）：

系统现在使用复杂的 **3 层检测算法**，结合真实世界实现的模式（Apache Superset、OpenObserve、variant-agents）：

```
第 1 层：语义分析（Apache Superset）
├─ is_temporal：检测日期、时间、年、月、q1-q4 等
├─ is_categorical：检测类别、类型、部门、地区
├─ is_geographic：检测地图、位置、国家、城市
├─ is_hierarchical：检测层次、级别、层级、金字塔、树
├─ is_financial：检测收入、利润、利润率、预算
└─ is_performance：检测 kpi、分数、评级、效率

第 2 层：结构推断（variant-agents）
├─ has_xy：二维数据（x, y）→ 散点图
├─ has_xyz：三维数据（x, y, z/大小）→ 气泡图
├─ has_ranges：范围数据（最小、最大、四分位数）→ 箱型图
├─ has_matrix：矩阵结构 → 热力图
├─ has_flow：流向数据（源、目标）→ 桑基图
├─ has_progress：进度数据（持续时间、开始、结束）→ 甘特图/瀑布图
└─ has_coordinates：地理数据（纬度、经度）→ 地图

第 3 层：基于规则的决策树（OpenObserve）
├─ 优先级 1：矩阵/流向/3D → 热力图/桑基图/气泡图
├─ 优先级 2：战略关键词 + 份额/增长 → BCG 矩阵
├─ 优先级 3：层次 → 金字塔图/树状图（≤5 vs >5 项）
├─ 优先级 4：时间 → 阶梯图/极坐标图/折线图
├─ 优先级 5：分类（≤5 小百分比）→ 环形图，（≤8 %）→ 饼图，否则 → 柱状图
├─ 优先级 6：多维（3-8 项）→ 雷达图
└─ 优先级 7：地理/回退 → 地图/柱状图

新增检测能力（超出原始 15 种模式）：
✓ 热力图检测（矩阵结构）
✓ 甘特图检测（进度数据）
✓ 瀑布图检测（顺序变化）
✓ 桑基图检测（流向数据）
✓ BCG 矩阵检测（市场份额 + 增长）
✓ 箱型图检测（范围数据）
✓ 树状图检测（大型层次结构）
✓ 小提琴图检测（分布密度）
```

**增强视觉设计**（阶段 3）：
- **动画**：进入向上、进入向左、悬停脉冲效果
- **排版**：改进的行高、字间距、字体层次
- **色盲友好调色板**：Viridis、Plasma、Cividis 选项
- **工具提示**：背景模糊、自定义阴影、更好的排版

**响应式设计**（阶段 6）：
- **4 个断点**：移动（<480px）、平板（768-1024px）、桌面（>1024px）、超宽屏（>1600px）
- **自适应布局**：移动端水平条形图、小屏幕隐藏图例
- **图表选项**：按屏幕宽度自动缩放、调整字体

**无障碍访问**（阶段 4）：
- **ARIA 标签**：所有 canvas 元素上的 role="img"、aria-describedby、aria-label
- **屏幕阅读器表格**：所有图表的回退数据表格
- **键盘导航**：箭头键、Home/End、Enter/Space 用于数据点选择
- **色盲支持**：冗余编码（颜色 + 图案）
- **WCAG 2.2 AA**：4.5:1 对比度、3:1 大文本

**性能优化**（阶段 5）：
- **懒加载**：Intersection Observer，50px 根边距
- **防抖调整大小**：调整大小事件 100ms 延迟
- **数据聚合**：大型数据集减少到约 1K 点
- **动画控制**：初始渲染时禁用

**实现方式**：
- `generator_v3.py`：包含所有增强的检测和渲染方法
- 检测方法：`_determine_chart_type_v4()`（多维分析）
- 向后兼容：保留原始的 `_determine_chart_type()`
- 新方法：`_render_bcg_matrix()`、`_render_gantt_chart()`、`_render_waterfall_chart()`、`_render_sankey_diagram()`、`_render_heatmap()`

---

## 📊 增强功能摘要

**已完成的阶段**：
1. ✅ **阶段 1**：增强的图表类型检测（3 层分析）
2. ✅ **阶段 2**：高级商务图表（5 种新类型）
3. ✅ **阶段 3**：视觉设计优化（动画、排版、色盲友好调色板）
4. ✅ **阶段 4**：无障碍功能（ARIA、键盘导航）
5. ✅ **阶段 5**：性能优化（懒加载、防抖）
6. ✅ **阶段 6**：响应式设计（4 个断点）
7. ✅ **阶段 7**：测试基础设施（综合测试套件）

**总体改进**：
- 图表类型：14 → 19（增加 36%）
- 检测维度：1 → 3（语义 + 结构 + 规则，改进 200%）
- 新图表方法：5 种高级商务图表
- 增强的 CSS：+450 行（动画、无障碍、性能、响应式）
- 测试套件：8 个测试函数，覆盖所有检测层
- 文档：更新了 SKILL.md，包含完整功能集

**下一步**：
- 生成包含所有 19 种图表类型的综合测试演示文稿
- 所有新图表的视觉验证
- 最终性能基准测试

```
看"排名" → 玉玦图、金字塔图
  用途：排名、层次级别、分层级数据
  示例：市场份额排名、绩效层级、优先级

看"流向" → 桑基图、瀑布图
  用途：阶段间的流向、顺序变化
  示例：客户旅程、现金流、转化漏斗

看"分布" → 箱型图、玫瑰图、气泡图
  用途：分布模式、异常值、扩散
  示例：考试成绩、客户年龄分布、产品类别

看"时间周期" → 极坐标弧长图、阶梯图
  用途：周期性模式、离散时间变化
  示例：季节性销售、季度结果、同比

看"KPI 达标" → 子弹图、差异箭头图
  用途：目标与实际对比、绩效指标
  示例：销售目标、预算差异、OKR 进度

看"多维度比较" → 雷达图、矩阵气泡图
  用途：多指标比较
  示例：产品功能、技能评估、竞争对手分析

看"占比关系" → 饼图、环形图、华夫图
  用途：部分与整体、构成
  示例：市场份额、预算细分、产品组合（≤5 项）

看"趋势变化" → 折线图、面积图
  用途：随时间变化的趋势、连续数据
  示例：收入增长、用户获取、股价

看"横向对比" → 条形图、蝴蝶图
  用途：长标签的类别比较
  示例：调查结果、区域比较、产品功能

看"战略分析" → BCG 矩阵、GE-McKinsey 九宫格、安索夫矩阵
  用途：战略定位、组合分析
  示例：产品组合、市场战略、投资决策

看"流程关系" → 泳道图、价值流程图、桑基图
  用途：流程流向、责任、增值
  示例：订单处理、客户旅程、制造

看"概率/风险" → 蒙特卡洛云、箱型图
  用途：不确定性、风险分析、概率
  示例：财务预测、项目估算、情景分析

看"层级" → 金字塔图、组织架构图
  用途：层次级别、自上而下结构
  示例：组织结构、优先级、马斯洛层次

看"递进" → 递进图、流程图、时间轴
  用途：顺序步骤、阶段、递进
  示例：项目阶段、旅程地图、实施步骤

看"强调" → 强调框、对比图、问题/解决方案
  用途：突出重点、重要信息
  示例：关键要点、关键见解、行动号召

看"循环" → 圆环/循环图、韦恩图
  用途：周期性流程、持续改进
  示例：反馈循环、产品生命周期、PDCA

看"关系" → 关系图、韦恩图、思维导图
  用途：概念之间的连接、依赖关系
  示例：利益相关者映射、系统关系、概念链接

看"对比" → 对比图、优缺点、Before/After
  用途：双边比较、之前/之后状态
  示例：优缺点、替代方案比较、改进结果

看"框架" → 黄金圈法则、5W1H、STAR
  用途：结构化沟通框架
  示例：战略信息传递、项目报告、面试准备
```

**实现方式**：
- Chart.js 库（从 CDN 加载：`https://cdn.jsdelivr.net/npm/chart.js`）
- 基于数据特征的自动图表类型检测
- 悬停时的交互式工具提示
- 具有最大高度约束的响应式大小
- 不支持的可视化类型回退到柱状图

## 文件结构

生成器（`scripts/generator_v3.py`）创建：
```
presentation.html（单文件）
├── CSS（内联，McKinsey 风格，约 540 行）
├── HTML（所有幻灯片）
└── JavaScript（内联）
    ├── 导航逻辑
    ├── 键盘处理程序
    ├── 全屏切换
    └── Chart.js 配置
```

## 禁止事项

- **永不修改原始内容或结论**：演示文稿必须完全保留所有原始含义、数据和结论
- **永不添加虚构数据**：仅使用源文档中的数据
- **永不使用 AI 生成的占位符文本**：使用源文档中的实际内容
- **永不偏离配色方案**：严格遵守指定的 McKinsey 风格调色板
- **永不一使用不一致的排版**：在所有幻灯片中保持层次和风格
- **永不过度拥挤幻灯片**：使用充足的留白并专注于关键信息
- **永不使用通用剪贴画或图标**：保持专业、商务适用的视觉效果
- **永不为风格牺牲清晰度**：确保数据和结论易于理解

## 资源

- **阶段详情**：参见 [references/phases.md](references/phases.md)
- **解析指南**：参见 [references/parsing-guidelines.md](references/parsing-guidelines.md)
- **最佳实践**：参见 [references/best-practices.md](references/best-practices.md)
- **设计模板**：参见 [assets/template.html](assets/template.html) 和 [assets/styles.css](assets/styles.css)
- **图表示例**：参见 [assets/chart-examples.html](assets/chart-examples.html)
- **输出示例**：参见 [presentation_demo/presentation_output.html](../../presentation_demo/presentation_output.html)

## 快速开始

```bash
# 1. 解析源文档
python3 skills/scripts/parser.py input.md -o parsed.json

# 2. 生成演示文稿
python3 skills/scripts/generator_v3.py parsed.json -o presentation.html

# 3. 在浏览器中打开
open presentation.html
```
