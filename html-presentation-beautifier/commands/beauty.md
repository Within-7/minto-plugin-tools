---
name: beauty
description: "将文档转化为专业 McKinsey 风格 HTML 演示文稿。严格遵循5步流程：1.文档内容分析合并 2.幻灯片设计与图文选择（⚠️布局优先原则：2.0先确定页面布局（单列/双列/三列/卡片网格/图表文本），2.1再选择图表图文；必须读beauty-html/references/chart-selection-guide.md和assets/CHART_EXAMPLES_INDEX.md）⚠️智能布局选择：优先使用横向布局（双列/三列/卡片网格），避免纵向长列表，应用随机选择机制 3.转化为McKinsey风格HTML（必须读beauty-html/references/best-practices.md和mckinsey-design-system.md及assets/presentation-template.html）⚠️图表修复：强制width:100%、responsive:true、maintainAspectRatio:false，确保图表正常显示 4.代码审核检验。⚠️ 第4步必须严格检验：1.内容完整性（100%保留原文所有章节/数据/结论，零遗漏）2.代码质量（符合HTML最佳实践，可访问可运行）3.资源使用（必须读取并参考beauty-html中的所有资源）4.图表显示（宽度非0、大小合理）5.布局优化（充分利用横向空间）6.布局合理性（布局优先于图表选择）。任一标准未通过必须返回对应步骤重新执行。"
---

# Beauty 命令

将文档、数据、结论等信息转化为通俗连贯、明确清晰的 McKinsey 风格 HTML 演示文稿。

## ⚠️ 核心原则

**必须严格遵循以下4步固定流程，不得跳过任何步骤：**

**🔑 步骤2、步骤3必须读取并参考skill资源：**
- **步骤2（图文选择）**：必须读 `beauty-html/references/chart-selection-guide.md`、`beauty-html/assets/CHART_EXAMPLES_INDEX.md`、`beauty-html/assets/INSIGHT_VISUALIZATION_GUIDE.md`
- **步骤3（HTML生成）**：必须读 `beauty-html/references/best-practices.md`、`beauty-html/references/mckinsey-design-system.md`、`beauty-html/assets/presentation-template.html`、`beauty-html/assets/TEMPLATE_USAGE_GUIDE.md`

**🔑 第4步是关键验收步骤，实行一票否决制：**
- **内容完整性检验**：必须100%保留原文所有章节、数据、结论，零遗漏
- **代码质量检验**：必须符合HTML最佳实践，可访问可运行
- **资源使用检验**：必须验证步骤2和步骤3是否正确读取并使用了skill资源
- **发现问题立即回退**：返回对应步骤重新执行，绝不将就

**⚠️ Token限制处理原则（严格执行，不得偷工减料）：**

**当遇到 token 限制或上下文长度问题时，必须使用"继续"分页方式，绝对禁止：**
- ❌ 压缩或省略资源读取
- ❌ 跳过必读资源
- ❌ 简化执行步骤
- ❌ 减少生成内容
- ❌ 使用摘要代替完整内容

**正确处理方式：使用"继续"机制**
```
1. 在完成当前可执行的部分后
2. 明确说明："由于 token 限制，任务未完成，请输入'继续'以获取剩余部分"
3. 等待用户输入"继续"后
4. 继续执行剩余步骤
5. 重复直到任务完全完成
```

**关键规则：**
- ✅ **质量 > 速度**：宁可多轮对话，不可降低质量
- ✅ **完整 > 简化**：宁可分多次执行，不可压缩内容
- ✅ **标准 > 妥协**：宁可触发继续，不可偷工减料

---

## 📋 固定4步执行流程

### 步骤 1️⃣：文档内容分析合并

**目标**：完整理解源文档内容，提取关键信息，建立内容结构。

**⚠️ Token限制处理机制：**

**如果文档过长无法一次性读取完整：**

```
正确做法（使用继续机制）：

步骤1.1：读取文档前半部分
├─ 使用 Read 工具读取文档（offset: 0, limit: 500）
├─ 提取前半部分的章节结构
├─ 记录前半部分的数据点
└─ 输出："步骤1.1完成 - 已分析文档前半部分（0-500行）
       请输入'继续'以分析后半部分"

【等待用户输入"继续"】

步骤1.2：读取文档后半部分
├─ 使用 Read 工具读取文档（offset: 500, limit: 500）
├─ 提取后半部分的章节结构
├─ 记录后半部分的数据点
└─ 输出："步骤1.2完成 - 已分析文档后半部分（500-1000行）
       文档分析100%完成"

【如果文档超过1000行，继续分片读取】

步骤1.3：合并分析结果
├─ 整合所有部分的分析结果
├─ 生成完整的章节结构清单
├─ 生成完整的数据点清单
└─ 进入步骤2
```

**❌ 禁止做法（偷工减料）：**
```
错误做法1：只读前几行
├─ Read 文件（limit: 50）
└─ ❌ 跳过了后面的内容

错误做法2：使用摘要
├─ 请用户总结文档内容
└─ ❌ 可能丢失细节

错误做法3：分步执行但不说明
├─ 只生成前半部分内容
└─ ❌ 用户不知道要继续
```

**执行要求**：
- ✅ 完整阅读源文档，不做任何修改或删减
- ✅ 识别文档类型（报告、分析、方案、研究等）
- ✅ 提取核心内容元素：
  - 标题层次结构（H1 → H2 → H3）
  - 关键数据和数值
  - 主要结论和见解
  - 重要建议和行动项
  - 对比关系和表格数据
- ✅ 建立内容逻辑结构：
  - 主题分组
  - 因果关系
  - 时间顺序
  - 优先级排序
- ✅ 记录所有定量数据（数字、百分比、货币等）

**输出产物**：
- 内容结构大纲（包含所有章节和要点）
- 数据点清单（所有可用于可视化的数值）
- 关键结论列表（必须完整保留）

**验证标准**：
- [ ] 所有原文内容已提取
- [ ] 无内容丢失或遗漏
- [ ] 数据点完整记录
- [ ] 逻辑结构清晰

---

---

### 步骤 2️⃣：幻灯片内容转换与拆分

**🎯 目标**：将文档内容完整转换为结构化的幻灯片页面，确保内容零遗漏、逻辑清晰、页面适量。

**⚠️ 核心原则**：
- ✅ 100%保留原文所有内容，零遗漏、零压缩、零简化
- ✅ 每页内容不超过8个要点，超过则分页展示
- ✅ 遇到内容过多时，使用"继续"机制分批处理
- ❌ 绝对禁止为了省token而压缩、省略、简化内容

---

#### 📋 步骤2执行流程（4个子步骤）

```
步骤2.1：识别文档结构层次
  ↓
步骤2.2：规划幻灯片页面类型
  ↓
步骤2.3：拆分内容到具体页面
  ↓
步骤2.4：验证内容完整性
```

---

#### 步骤 2.1：识别文档结构层次

**🎯 目标**：完整识别文档的所有标题层级和内容块，建立清晰的结构地图。

**执行要求**：

**阶段1：提取标题层级**

基于步骤1的分析结果，提取完整的标题结构：

```markdown
文档结构地图：

H1: 主标题（文档总标题）
  ├─ H2: 第一章节
  │   ├─ H3: 子章节1.1
  │   │   ├─ 要点1
  │   │   ├─ 要点2
  │   │   └─ 要点3
  │   ├─ H3: 子章节1.2
  │   │   ├─ 要点1
  │   │   └─ 要点2
  │   └─ H3: 子章节1.3
  │       └─ 要点1
  ├─ H2: 第二章节
  │   ├─ H3: 子章节2.1
  │   └─ H3: 子章节2.2
  └─ H2: 第三章节
      └─ H3: 子章节3.1
```

**阶段2：统计内容密度**

为每个章节统计内容量：

```markdown
内容密度统计：

第一章节（H2）：
  ├─ 子章节1.1：要点数 3个，数据点 2个，表格 0个
  ├─ 子章节1.2：要点数 2个，数据点 5个，表格 1个
  └─ 子章节1.3：要点数 1个，数据点 0个，表格 0个
  → 章节总计：要点 6个，数据点 7个，表格 1个

第二章节（H2）：
  ├─ 子章节2.1：要点数 8个，数据点 3个，表格 0个
  ├─ 子章节2.2：要点数 12个，数据点 0个，表格 2个
  → 章节总计：要点 20个，数据点 3个，表格 2个

第三章节（H2）：
  └─ 子章节3.1：要点数 4个，数据点 1个，表格 0个
  → 章节总计：要点 4个，数据点 1个，表格 0个
```

**阶段3：识别特殊内容块**

标记需要特殊处理的内容：

```markdown
特殊内容标记：

□ 对比分析（A vs B）：第X章节
□ 时间序列（2024-2026）：第Y章节
□ 数据表格（≥3列）：第Z章节
□ 流程步骤（1→2→3）：第W章节
□ 案例故事：第V章节
□ 强调结论："关键发现"、"核心建议"
```

**⚠️ Token限制处理：如果文档结构很长**

```
如果文档包含10+个H2章节，必须分批识别：

阶段1a：识别前5个H2章节
├─ 提取H1和前5个H2的完整结构
├─ 统计前5个章节的内容密度
└─ 输出："步骤2.1阶段1a完成 - 已识别前5个章节结构
       请输入'继续'以识别剩余章节"

【等待用户输入"继续"】

阶段1b：识别后续H2章节
├─ 提取剩余H2的完整结构
├─ 统计剩余章节的内容密度
└─ 输出："步骤2.1阶段1b完成 - 章节结构100%识别完成
       已进入步骤2.2"
```

**输出产物**：

- 完整的文档结构地图（所有H1/H2/H3）
- 内容密度统计表（每章节的要点数、数据点数）
- 特殊内容标记清单

**验证标准**：

- [ ] 所有标题层级已识别
- [ ] 内容密度已统计
- [ ] 特殊内容已标记
- [ ] 无遗漏章节

---

#### 步骤 2.2：规划幻灯片页面类型

**🎯 目标**：根据文档结构，规划所有幻灯片页面的类型和数量。

**幻灯片页面类型清单（5种）**

**P1. 封面页（Cover Page）**
- **数量**：1页
- **内容**：
  - 文档主标题（H1）
  - 副标题/核心主题（如有）
  - 日期或版本信息（如有）
  - 作者或机构（如有）
- **示例**：`01-cover-page.html`

**P2. 目录页（Table of Contents）**
- **数量**：1-2页
- **内容**：
  - 所有H2章节标题
  - 章节编号（如：01, 02, 03）
  - 章节简要描述（如有）
- **分页规则**：
  - ≤6个章节 → 1页目录（列表式或网格式）
  - 7-12个章节 → 2页目录（每页6个）
  - ≥13个章节 → 分组目录（按主题分2-3页）
- **示例**：`08-table-of-contents.html`（列表式）、`10-toc-grid-cards.html`（网格式）

**P3. 章节首页（Chapter Cover）**
- **数量**：每个H2章节1页
- **内容**：
  - 章节标题（H2）
  - 章节编号（如：第一章）
  - 章节简要描述（1-2句话概括）
  - 子章节导航（可选，如果H3≤4个）
- **示例**：`11-chapter-overview.html`

**P4. 内容页（Content Page）**
- **数量**：根据内容密度动态计算
- **内容**：
  - 页面标题（H3或主题）
  - 要点列表（≤8个要点）
  - 数据/图表（如有）
  - 表格（如有）
  - 关键结论（如有）
- **分页规则**：
  - ≤8个要点 → 1页
  - 9-16个要点 → 2页（每页≤8个）
  - 17-24个要点 → 3页（每页≤8个）
  - 以此类推
- **示例**：`02-two-column-comparison.html`、`03-three-column.html`、`04-card-grid.html`等

**P5. 结束页（Closing Page）**
- **数量**：1页
- **内容**：
  - "谢谢" 或 "Thank You"
  - 联系方式（如有）
  - 下一步行动（如有）
  - Q&A提示（可选）

**执行流程**：

**阶段1：规划固定页面**

```markdown
固定页面规划：

1. 封面页（P1）：1页
   - 标题：[文档H1标题]
   - 副标题：[如有]

2. 目录页（P2）：X页
   - 章节数量：[N个H2章节]
   - 分页方案：
     □ N≤6 → 1页（列表式/网格式）
     □ 7≤N≤12 → 2页（每页6个）
     □ N≥13 → 分组目录

3. 结束页（P5）：1页
   - 内容：谢谢 + 联系方式

→ 固定页面总计：[1 + X + 1] 页
```

**阶段2：规划章节首页**

```markdown
章节首页规划（P3）：

第一章：[章节标题]
  - 章节首页：1页
  - 内容：标题 + 描述 + 子章节导航

第二章：[章节标题]
  - 章节首页：1页
  - 内容：标题 + 描述 + 子章节导航

...

→ 章节首页总计：[N个H2] 页
```

**阶段3：规划内容页（关键步骤）**

根据步骤2.1的内容密度统计，计算每个章节需要的内容页数量：

```markdown
内容页规划（P4）：

第一章：[章节标题]（总要点：6个）
  ├─ 子章节1.1（3个要点）→ 1页内容页
  ├─ 子章节1.2（2个要点 + 1个表格）→ 1页内容页
  └─ 子章节1.3（1个要点）→ 1页内容页
  → 第一章内容页：3页

第二章：[章节标题]（总要点：20个）
  ├─ 子章节2.1（8个要点）→ 1页内容页
  └─ 子章节2.2（12个要点 + 2个表格）→ 需要分页
      ├─ 内容页1：前8个要点
      └─ 内容页2：后4个要点 + 2个表格
  → 第二章内容页：3页

第三章：[章节标题]（总要点：4个）
  └─ 子章节3.1（4个要点）→ 1页内容页
  → 第三章内容页：1页

→ 内容页总计：7页
```

**⚠️ 分页规则详解**

**规则1：单页内容上限**
```
每页最多包含：
- 8个要点（bullet points）
- 或 6个要点 + 1个图表
- 或 4个要点 + 1个表格
- 或 2个图表
- 或 1个大型表格（≥5行）
```

**规则2：分页策略**
```
如果子章节包含12个要点：
❌ 错误做法：压缩为1页，每个要点缩减文字
✅ 正确做法：拆分为2页
   - 页面1：前8个要点（标题：子章节名 - 上）
   - 页面2：后4个要点（标题：子章节名 - 下）

如果子章节包含20个要点：
✅ 正确做法：拆分为3页
   - 页面1：要点1-8（标题：子章节名 - 第1部分）
   - 页面2：要点9-16（标题：子章节名 - 第2部分）
   - 页面3：要点17-20（标题：子章节名 - 第3部分）
```

**规则3：内容分组优先**
```
如果子章节有明确的内容分组：
优先按分组拆分，而非机械地按8个要点切割

例如：
子章节2.2：平台分析（12个要点）
  - 分组1：商业模式（5个要点）→ 页面1
  - 分组2：用户策略（4个要点）→ 页面2
  - 分组3：内容策略（3个要点）→ 页面2（合并到页面2）
```

**阶段4：汇总页面总数**

```markdown
幻灯片页面总数汇总：

1. 封面页（P1）：1页
2. 目录页（P2）：X页
3. 章节首页（P3）：N页（N = H2章节数）
4. 内容页（P4）：M页（根据内容密度计算）
5. 结束页（P5）：1页

→ 总计：[1 + X + N + M + 1] 页
```

**⚠️ Token限制处理：如果章节很多**

```
如果文档包含10+个H2章节，必须分批规划：

阶段3a：规划前5个章节的内容页
├─ 计算前5个章节的内容页数量
├─ 详细列出每页的标题和内容要点数
└─ 输出："步骤2.2阶段3a完成 - 已规划前5个章节的内容页（共X页）
       请输入'继续'以规划剩余章节"

【等待用户输入"继续"】

阶段3b：规划剩余章节的内容页
├─ 计算剩余章节的内容页数量
├─ 详细列出每页的标题和内容要点数
└─ 输出："步骤2.2阶段3b完成 - 所有内容页规划完成（总计Y页）
       已进入步骤2.3"
```

**输出产物**：

- 幻灯片页面类型清单（P1-P5）
- 每种类型的页面数量
- 内容页的详细分页方案
- 幻灯片总页数

**验证标准**：

- [ ] 所有页面类型已规划
- [ ] 内容页分页合理（每页≤8个要点）
- [ ] 总页数已计算
- [ ] 无内容遗漏

---

#### 步骤 2.3：拆分内容到具体页面

**🎯 目标**：将文档内容完整、准确地分配到每一页幻灯片，生成详细的页面内容清单。

**执行要求**：

为每一页幻灯片创建详细的内容清单，包含：
- 页面编号
- 页面类型
- 页面标题
- 具体内容（完整文字，不压缩）
- 数据点（如有）
- 图表类型（如有）
- 表格内容（如有）

**执行流程**：

**阶段1：拆分封面页和目录页**

```markdown
===== 页面 1：封面页 =====
页面类型：P1 - Cover Page
页面标题：[文档H1标题]

页面内容：
- 主标题：[完整标题文字]
- 副标题：[完整副标题文字]
- 日期：[日期信息]
- 作者：[作者信息]

---

===== 页面 2：目录页 =====
页面类型：P2 - Table of Contents
页面标题：目录 / Contents

页面内容：
1. [第一章完整标题]
2. [第二章完整标题]
3. [第三章完整标题]
4. [第四章完整标题]
5. [第五章完整标题]
6. [第六章完整标题]

（如果章节>6个，继续列出或分页）
```

**阶段2：拆分章节首页**

```markdown
===== 页面 3：第一章章节首页 =====
页面类型：P3 - Chapter Cover
页面标题：第一章 - [完整章节标题]

页面内容：
- 章节编号：01
- 章节标题：[完整标题]
- 章节描述：[1-2句话描述该章节的核心内容]
- 子章节导航：
  □ 1.1 [子章节完整标题]
  □ 1.2 [子章节完整标题]
  □ 1.3 [子章节完整标题]

---

===== 页面 4：第二章章节首页 =====
页面类型：P3 - Chapter Cover
页面标题：第二章 - [完整章节标题]

（以此类推...）
```

**阶段3：拆分内容页（最重要）**

**⚠️ 关键原则：100%保留原文内容，不压缩、不省略、不简化**

```markdown
===== 页面 5：内容页 - 子章节1.1 =====
页面类型：P4 - Content Page
页面标题：[子章节1.1完整标题]

页面内容：
1. [要点1完整文字]
   - [子要点1.1完整文字]
   - [子要点1.2完整文字]

2. [要点2完整文字]
   - [子要点2.1完整文字]

3. [要点3完整文字]

数据点：
- [数据1]：[具体数值 + 单位 + 说明]
- [数据2]：[具体数值 + 单位 + 说明]

图表（如有）：
- 图表类型：[柱状图/折线图/饼图等]
- 图表标题：[完整标题]
- 图表数据：[完整数据列表]

表格（如有）：
| 列1标题 | 列2标题 | 列3标题 |
|---------|---------|---------|
| [数据1] | [数据2] | [数据3] |
| [数据4] | [数据5] | [数据6] |

关键结论（如有）：
- [结论1完整文字]
- [结论2完整文字]

---

===== 页面 6：内容页 - 子章节1.2 =====
页面类型：P4 - Content Page
页面标题：[子章节1.2完整标题]

（以此类推...）
```

**⚠️ 分页示例（超过8个要点时）**

```markdown
===== 页面 10：内容页 - 子章节2.2（第1部分）=====
页面类型：P4 - Content Page
页面标题：[子章节2.2完整标题] - 第1部分

页面内容：
1. [要点1完整文字]
2. [要点2完整文字]
3. [要点3完整文字]
4. [要点4完整文字]
5. [要点5完整文字]
6. [要点6完整文字]
7. [要点7完整文字]
8. [要点8完整文字]

---

===== 页面 11：内容页 - 子章节2.2（第2部分）=====
页面类型：P4 - Content Page
页面标题：[子章节2.2完整标题] - 第2部分

页面内容：
9. [要点9完整文字]
10. [要点10完整文字]
11. [要点11完整文字]
12. [要点12完整文字]

表格：
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| ... | ... | ... |
```

**阶段4：拆分结束页**

```markdown
===== 页面 N：结束页 =====
页面类型：P5 - Closing Page
页面标题：谢谢 / Thank You

页面内容：
- 感谢语：谢谢观看 / Thank You
- 联系方式：[邮箱/电话/网站]
- 下一步行动：[如有]
- Q&A提示：Questions?
```

**⚠️ Token限制处理：如果内容页很多**

```
如果内容页超过20页，必须分批拆分：

阶段3a：拆分前10页内容页
├─ 详细列出每页的完整内容（100%原文）
├─ 包含所有要点、数据、图表、表格
└─ 输出："步骤2.3阶段3a完成 - 已拆分前10页内容页
       当前进度：页面1-15已完成（封面+目录+章节首页+前10页内容）
       请输入'继续'以拆分剩余内容页"

【等待用户输入"继续"】

阶段3b：拆分剩余内容页
├─ 详细列出每页的完整内容（100%原文）
├─ 包含所有要点、数据、图表、表格
└─ 输出："步骤2.3阶段3b完成 - 所有内容页拆分完成
       总页数：N页
       已进入步骤2.4"
```

**⚠️ 严禁以下做法**

```
❌ 错误做法1：压缩内容
错误示例：
页面内容：
1. 商业模式分析（包含5个要点，省略详细内容）

✅ 正确做法：
页面内容：
1. [要点1完整文字，包含所有细节]
2. [要点2完整文字，包含所有细节]
3. [要点3完整文字，包含所有细节]
4. [要点4完整文字，包含所有细节]
5. [要点5完整文字，包含所有细节]

---

❌ 错误做法2：省略数据
错误示例：
数据点：包含多个数据点（略）

✅ 正确做法：
数据点：
- 平台A估值：14-21亿美元
- 平台B估值：150-200万美元
- 估值差距：10-20倍
- 市场份额：65%
- 用户增长率：15%

---

❌ 错误做法3：简化表格
错误示例：
表格：包含对比数据（略）

✅ 正确做法：
表格：
| 平台 | 估值 | 用户数 | 增长率 |
|------|------|--------|--------|
| A    | 20亿 | 5000万 | 15%    |
| B    | 180万| 50万   | 8%     |
| C    | 5亿  | 1000万 | 12%    |
```

**输出产物**：

- 完整的幻灯片页面清单（从第1页到第N页）
- 每页的详细内容（100%原文，无压缩）
- 每页的数据点、图表、表格（如有）
- 页面总数确认

**验证标准**：

- [ ] 所有页面已详细列出
- [ ] 每页内容完整（100%原文）
- [ ] 每页要点数≤8个
- [ ] 数据、图表、表格完整
- [ ] 页面编号连续
- [ ] 无内容遗漏

---

#### 步骤 2.4：验证内容完整性

**🎯 目标**：逐项对照原文档，确保所有内容都已分配到幻灯片页面，零遗漏。

**执行要求**：

**验证方法1：章节对照表**

```markdown
章节完整性对照：

原文档章节                    对应幻灯片页面              状态
─────────────────────────────────────────────────────────
H1: [文档标题]                页面1（封面页）              ✓
目录                          页面2（目录页）              ✓
H2: 第一章 [标题]             页面3（章节首页）            ✓
  H3: 1.1 [子标题]            页面5（内容页）              ✓
  H3: 1.2 [子标题]            页面6（内容页）              ✓
  H3: 1.3 [子标题]            页面7（内容页）              ✓
H2: 第二章 [标题]             页面4（章节首页）            ✓
  H3: 2.1 [子标题]            页面8（内容页）              ✓
  H3: 2.2 [子标题]            页面9-10（内容页，分2页）    ✓
H2: 第三章 [标题]             页面11（章节首页）           ✓
  H3: 3.1 [子标题]            页面12（内容页）             ✓
结束页                        页面13（结束页）             ✓

验证结果：所有章节 ✓ 已分配
```

**验证方法2：要点计数对照**

```markdown
要点完整性对照：

章节                原文要点数    幻灯片要点数    状态
────────────────────────────────────────────────
第一章 1.1          3个           3个             ✓
第一章 1.2          2个           2个             ✓
第一章 1.3          1个           1个             ✓
第二章 2.1          8个           8个             ✓
第二章 2.2          12个          12个            ✓
第三章 3.1          4个           4个             ✓
────────────────────────────────────────────────
总计                30个          30个            ✓

验证结果：要点数量 ✓ 完全匹配
```

**验证方法3：数据点对照**

```markdown
数据点完整性对照：

原文数据点                          对应页面    状态
──────────────────────────────────────────────
平台A估值：14-21亿美元              页面5       ✓
平台B估值：150-200万美元            页面5       ✓
估值差距：10-20倍                   页面5       ✓
市场份额：65%                       页面6       ✓
用户增长率：15%                     页面6       ✓
...

验证结果：数据点 ✓ 全部保留
```

**验证方法4：表格和图表对照**

```markdown
表格/图表完整性对照：

原文表格/图表                       对应页面    状态
──────────────────────────────────────────────
表格1：平台对比表（3列5行）         页面6       ✓
表格2：收入结构表（4列3行）         页面10      ✓
图表1：估值对比柱状图               页面5       ✓
图表2：用户增长折线图               页面8       ✓
...

验证结果：表格/图表 ✓ 全部包含
```

**验证方法5：关键结论对照**

```markdown
关键结论完整性对照：

原文关键结论                        对应页面    状态
──────────────────────────────────────────────
"强烈建议..."                       页面12      ✓
"核心发现是..."                     页面8       ✓
"关键优势在于..."                   页面6       ✓
...

验证结果：关键结论 ✓ 全部保留
```

**⚠️ 发现遗漏时的处理**

```
如果验证发现任何内容遗漏：

立即停止！执行回退流程：

1. 记录遗漏内容：
   - 遗漏章节：[章节名]
   - 遗漏要点：[要点内容]
   - 遗漏数据：[数据内容]

2. 返回步骤2.3（拆分内容）：
   - 补充遗漏内容到对应页面
   - 重新生成完整的页面清单
   - 重新验证内容完整性

3. 如果遗漏原因是步骤2.1或2.2的问题，则返回更早的步骤：
   - 返回步骤2.1：重新识别文档结构
   - 返回步骤2.2：重新规划页面类型
   - 依次重新执行后续步骤

4. 重新验证直到100%通过
```

**⚠️ Token限制处理：如果验证内容很多**

```
如果幻灯片页面超过30页，必须分批验证：

验证阶段1：验证前15页
├─ 对照前15页的章节完整性
├─ 对照前15页的要点数量
├─ 对照前15页的数据点
└─ 输出："步骤2.4验证阶段1完成 - 前15页验证通过 ✓
       请输入'继续'以验证剩余页面"

【等待用户输入"继续"】

验证阶段2：验证剩余页面
├─ 对照剩余页面的章节完整性
├─ 对照剩余页面的要点数量
├─ 对照剩余页面的数据点
└─ 输出："步骤2.4验证阶段2完成 - 所有页面验证通过 ✓
       内容完整性：100%
       步骤2全部完成，已进入步骤3"
```

**输出产物**：

- 章节对照表（100%匹配）
- 要点计数对照表（数量一致）
- 数据点对照表（全部保留）
- 表格/图表对照表（全部包含）
- 关键结论对照表（全部保留）
- 验证报告（通过/不通过）

**验证标准**：

- [ ] 所有章节已分配到页面
- [ ] 要点数量完全匹配
- [ ] 数据点全部保留
- [ ] 表格/图表全部包含
- [ ] 关键结论全部保留
- [ ] 无任何内容遗漏

---

#### 📊 步骤2完整示例

**示例文档结构**：

```markdown
# 知识付费平台分析报告

## 第一章：市场概况
### 1.1 行业现状
- 要点1：市场规模达到500亿
- 要点2：用户增长率15%
- 要点3：头部平台占据65%份额

### 1.2 竞争格局
- 要点1：平台A估值14-21亿美元
- 要点2：平台B估值150-200万美元
- 要点3：估值差距10-20倍
- 要点4：内容质量是关键

## 第二章：平台分析
### 2.1 商业模式
- 要点1：订阅制
- 要点2：单次付费
- 要点3：广告模式
- 要点4：混合模式

### 2.2 六大平台启示
- 要点1：得到 - 知识服务
- 要点2：喜马拉雅 - 音频内容
- 要点3：知乎 - 社区问答
- 要点4：樊登读书 - 读书服务
- 要点5：混沌学园 - 商学教育
- 要点6：蜻蜓FM - 广播电台
- 要点7：小鹅通 - 工具平台
- 要点8：荔枝微课 - 轻量课程
- 要点9：千聊 - 直播课程
- 要点10：有书 - 阅读社群

## 第三章：核心建议
### 3.1 战略建议
- 要点1：聚焦细分市场
- 要点2：打造内容护城河
- 要点3：建立用户社群
- 要点4：优化变现模式
```

**步骤2.1输出：识别文档结构层次**

```markdown
文档结构地图：

H1: 知识付费平台分析报告
  ├─ H2: 第一章：市场概况
  │   ├─ H3: 1.1 行业现状（3个要点）
  │   └─ H3: 1.2 竞争格局（4个要点）
  ├─ H2: 第二章：平台分析
  │   ├─ H3: 2.1 商业模式（4个要点）
  │   └─ H3: 2.2 六大平台启示（10个要点）
  └─ H2: 第三章：核心建议
      └─ H3: 3.1 战略建议（4个要点）

内容密度统计：
- 第一章：7个要点
- 第二章：14个要点
- 第三章：4个要点
- 总计：25个要点

特殊内容标记：
□ 数据密集：1.2竞争格局（包含估值数据）
□ 需要分页：2.2六大平台启示（10个要点，超过8个）
```

**步骤2.2输出：规划幻灯片页面类型**

```markdown
幻灯片页面规划：

1. 封面页（P1）：1页
   - 标题：知识付费平台分析报告

2. 目录页（P2）：1页
   - 3个章节（≤6个，使用1页网格式目录）

3. 章节首页（P3）：3页
   - 页面3：第一章章节首页
   - 页面4：第二章章节首页
   - 页面5：第三章章节首页

4. 内容页（P4）：8页
   第一章：
   - 页面6：1.1 行业现状（3个要点）→ 1页
   - 页面7：1.2 竞争格局（4个要点）→ 1页

   第二章：
   - 页面8：2.1 商业模式（4个要点）→ 1页
   - 页面9：2.2 六大平台启示 - 第1部分（前6个要点）→ 1页
   - 页面10：2.2 六大平台启示 - 第2部分（后4个要点）→ 1页

   第三章：
   - 页面11：3.1 战略建议（4个要点）→ 1页

5. 结束页（P5）：1页
   - 页面12：谢谢

总页数：1 + 1 + 3 + 6 + 1 = 12页
```

**步骤2.3输出：拆分内容到具体页面**

```markdown
===== 页面 1：封面页 =====
页面类型：P1 - Cover Page
页面标题：知识付费平台分析报告

页面内容：
- 主标题：知识付费平台分析报告
- 副标题：市场分析与战略建议
- 日期：2024年

---

===== 页面 2：目录页 =====
页面类型：P2 - Table of Contents
页面标题：目录

页面内容：
1. 第一章：市场概况
2. 第二章：平台分析
3. 第三章：核心建议

---

===== 页面 3：第一章章节首页 =====
页面类型：P3 - Chapter Cover
页面标题：第一章 - 市场概况

页面内容：
- 章节编号：01
- 章节标题：市场概况
- 章节描述：分析知识付费行业的整体现状和竞争格局
- 子章节导航：
  □ 1.1 行业现状
  □ 1.2 竞争格局

---

===== 页面 4：第二章章节首页 =====
页面类型：P3 - Chapter Cover
页面标题：第二章 - 平台分析

页面内容：
- 章节编号：02
- 章节标题：平台分析
- 章节描述：深入分析主流平台的商业模式和核心启示
- 子章节导航：
  □ 2.1 商业模式
  □ 2.2 六大平台启示

---

===== 页面 5：第三章章节首页 =====
页面类型：P3 - Chapter Cover
页面标题：第三章 - 核心建议

页面内容：
- 章节编号：03
- 章节标题：核心建议
- 章节描述：基于市场分析提出的战略建议
- 子章节导航：
  □ 3.1 战略建议

---

===== 页面 6：内容页 - 行业现状 =====
页面类型：P4 - Content Page
页面标题：1.1 行业现状

页面内容：
1. 市场规模达到500亿
   - 知识付费行业近年来快速发展
   - 2024年市场规模突破500亿元人民币
   - 年复合增长率保持在20%以上

2. 用户增长率15%
   - 付费用户数量持续增长
   - 2024年增长率为15%
   - 用户付费意愿显著提升

3. 头部平台占据65%份额
   - 市场集中度较高
   - 前10大平台占据65%市场份额
   - 长尾平台生存空间有限

数据点：
- 市场规模：500亿元人民币
- 年复合增长率：20%
- 用户增长率：15%
- 头部平台市场份额：65%

---

===== 页面 7：内容页 - 竞争格局 =====
页面类型：P4 - Content Page
页面标题：1.2 竞争格局

页面内容：
1. 平台A估值14-21亿美元
   - 头部平台估值水平较高
   - 平台A最新估值区间为14-21亿美元
   - 已完成多轮融资

2. 平台B估值150-200万美元
   - 中小平台估值差异巨大
   - 平台B估值仅为150-200万美元
   - 融资困难，盈利压力大

3. 估值差距10-20倍
   - 头部平台与中小平台估值差距明显
   - 差距达到10-20倍
   - 马太效应显著

4. 内容质量是关键
   - 优质内容是核心竞争力
   - 内容质量直接影响用户留存
   - 头部平台在内容生产上投入巨大

数据点：
- 平台A估值：14-21亿美元
- 平台B估值：150-200万美元
- 估值差距：10-20倍

图表：
- 图表类型：对比柱状图
- 图表标题：头部平台vs中小平台估值对比
- 图表数据：
  * 平台A：18亿美元（取中值）
  * 平台B：175万美元（取中值）

---

===== 页面 8：内容页 - 商业模式 =====
页面类型：P4 - Content Page
页面标题：2.1 商业模式

页面内容：
1. 订阅制
   - 用户按月/年订阅获取内容
   - 稳定的现金流
   - 代表平台：得到、樊登读书

2. 单次付费
   - 用户购买单个课程或内容
   - 灵活性高，用户门槛低
   - 代表平台：知乎、喜马拉雅

3. 广告模式
   - 免费内容+广告变现
   - 用户基数大，但单用户价值低
   - 代表平台：蜻蜓FM

4. 混合模式
   - 结合多种变现方式
   - 收入来源多元化
   - 代表平台：小鹅通、千聊

---

===== 页面 9：内容页 - 六大平台启示（第1部分）=====
页面类型：P4 - Content Page
页面标题：2.2 六大平台启示 - 第1部分

页面内容：
1. 得到 - 知识服务
   - 定位：精品知识服务平台
   - 核心：严选课程+音频书
   - 启示：内容质量>数量

2. 喜马拉雅 - 音频内容
   - 定位：综合音频平台
   - 核心：海量内容+UGC
   - 启示：内容丰富度很重要

3. 知乎 - 社区问答
   - 定位：知识问答社区
   - 核心：UGC+社区氛围
   - 启示：社区价值不可忽视

4. 樊登读书 - 读书服务
   - 定位：读书知识服务
   - 核心：书籍精华+社群
   - 启示：垂直领域深耕

5. 混沌学园 - 商学教育
   - 定位：创新商学教育
   - 核心：高端课程+线下活动
   - 启示：高客单价模式可行

6. 蜻蜓FM - 广播电台
   - 定位：网络音频电台
   - 核心：版权内容+直播
   - 启示：版权内容是护城河

---

===== 页面 10：内容页 - 六大平台启示（第2部分）=====
页面类型：P4 - Content Page
页面标题：2.2 六大平台启示 - 第2部分

页面内容：
7. 小鹅通 - 工具平台
   - 定位：知识付费技术服务商
   - 核心：SaaS工具+生态
   - 启示：赋能B端是新方向

8. 荔枝微课 - 轻量课程
   - 定位：轻量级课程平台
   - 核心：低价课程+快速传播
   - 启示：下沉市场有机会

9. 千聊 - 直播课程
   - 定位：直播课程平台
   - 核心：实时互动+社群
   - 启示：互动性提升转化

10. 有书 - 阅读社群
    - 定位：阅读社群平台
    - 核心：共读+社群运营
    - 启示：社群运营是关键

---

===== 页面 11：内容页 - 战略建议 =====
页面类型：P4 - Content Page
页面标题：3.1 战略建议

页面内容：
1. 聚焦细分市场
   - 避免与头部平台正面竞争
   - 选择垂直细分领域深耕
   - 建立差异化竞争优势

2. 打造内容护城河
   - 内容是核心竞争力
   - 投入资源生产优质内容
   - 建立内容生产机制

3. 建立用户社群
   - 社群提升用户粘性
   - 通过社群运营增强用户归属感
   - 社群是口碑传播的基础

4. 优化变现模式
   - 探索多元化变现方式
   - 平衡用户体验与商业化
   - 提升单用户价值

关键结论：
- 强烈建议新平台聚焦细分市场，避免与头部平台直接竞争
- 内容质量是长期竞争力的核心
- 社群运营能够显著提升用户留存率

---

===== 页面 12：结束页 =====
页面类型：P5 - Closing Page
页面标题：谢谢

页面内容：
- 感谢语：Thank You
- 联系方式：contact@example.com
- Q&A提示：Questions?
```

**步骤2.4输出：验证内容完整性**

```markdown
章节完整性对照：

原文档章节                    对应幻灯片页面              状态
─────────────────────────────────────────────────────────
H1: 知识付费平台分析报告      页面1（封面页）              ✓
目录                          页面2（目录页）              ✓
H2: 第一章：市场概况          页面3（章节首页）            ✓
  H3: 1.1 行业现状            页面6（内容页）              ✓
  H3: 1.2 竞争格局            页面7（内容页）              ✓
H2: 第二章：平台分析          页面4（章节首页）            ✓
  H3: 2.1 商业模式            页面8（内容页）              ✓
  H3: 2.2 六大平台启示        页面9-10（内容页，分2页）    ✓
H2: 第三章：核心建议          页面5（章节首页）            ✓
  H3: 3.1 战略建议            页面11（内容页）             ✓
结束页                        页面12（结束页）             ✓

验证结果：所有章节 ✓ 已分配

---

要点完整性对照：

章节                原文要点数    幻灯片要点数    状态
────────────────────────────────────────────────
1.1 行业现状        3个           3个             ✓
1.2 竞争格局        4个           4个             ✓
2.1 商业模式        4个           4个             ✓
2.2 六大平台启示    10个          10个            ✓
3.1 战略建议        4个           4个             ✓
────────────────────────────────────────────────
总计                25个          25个            ✓

验证结果：要点数量 ✓ 完全匹配

---

数据点完整性对照：

原文数据点                          对应页面    状态
──────────────────────────────────────────────
市场规模：500亿元                   页面6       ✓
年复合增长率：20%                   页面6       ✓
用户增长率：15%                     页面6       ✓
头部平台市场份额：65%               页面6       ✓
平台A估值：14-21亿美元              页面7       ✓
平台B估值：150-200万美元            页面7       ✓
估值差距：10-20倍                   页面7       ✓

验证结果：数据点 ✓ 全部保留

---

图表完整性对照：

原文图表                            对应页面    状态
──────────────────────────────────────────────
估值对比柱状图                      页面7       ✓

验证结果：图表 ✓ 全部包含

---

关键结论完整性对照：

原文关键结论                        对应页面    状态
──────────────────────────────────────────────
"强烈建议新平台聚焦细分市场..."    页面11      ✓
"内容质量是长期竞争力的核心"      页面11      ✓
"社群运营能够显著提升用户留存率"  页面11      ✓

验证结果：关键结论 ✓ 全部保留

---

✅ 步骤2验证通过！
- 内容完整性：100%
- 总页数：12页
- 已进入步骤3（McKinsey风格HTML生成）
```

---

#### 📊 步骤2输出清单

**步骤2完成后，必须输出以下产物：**

1. **文档结构地图**（步骤2.1）
   - 所有H1/H2/H3标题
   - 每个章节的要点数量
   - 特殊内容标记

2. **幻灯片页面规划表**（步骤2.2）
   - 5种页面类型的数量
   - 内容页的详细分页方案
   - 总页数

3. **完整页面内容清单**（步骤2.3）
   - 从第1页到第N页的详细内容
   - 每页100%原文内容
   - 所有数据、图表、表格

4. **内容完整性验证报告**（步骤2.4）
   - 章节对照表
   - 要点计数对照表
   - 数据点对照表
   - 验证结果（通过/不通过）

---

#### ⚠️ 步骤2关键提醒

1. **内容完整性是第一优先级**
   - 宁可多做页面，不可丢失内容
   - 宁可分页展示，不可压缩内容
   - 宁可触发"继续"，不可简化内容

2. **每页内容上限严格执行**
   - 最多8个要点
   - 超过必须分页
   - 分页时保持逻辑完整

3. **Token限制正确处理**
   - 使用"继续"机制分批处理
   - 每批处理完成后明确说明进度
   - 提示用户输入"继续"
   - 最终100%完成所有内容

4. **验证环节不可跳过**
   - 必须逐项对照原文
   - 发现遗漏立即回退
   - 验证通过才能进入步骤3

---

#### ✅ 步骤2验收标准

**以下所有标准必须100%通过：**

- [ ] 文档结构已完整识别
- [ ] 页面类型已合理规划
- [ ] 所有内容已分配到页面
- [ ] 每页要点数≤8个
- [ ] 分页逻辑清晰合理
- [ ] 章节对照表100%匹配
- [ ] 要点数量完全一致
- [ ] 数据点全部保留
- [ ] 图表全部包含
- [ ] 关键结论全部保留
- [ ] 验证报告显示"通过"

**如果任何一项未通过，必须返回对应子步骤重新执行！**

---

**步骤2完成后，输出：**

```
✅ 步骤2：幻灯片内容转换与拆分 - 100%完成

输出摘要：
- 文档结构：[N个H2章节，M个H3子章节]
- 总页数：[X页]
- 页面类型：封面1页 + 目录Y页 + 章节首页Z页 + 内容页W页 + 结束1页
- 内容完整性：100% ✓
- 验证状态：通过 ✓

已进入步骤3：转化为McKinsey风格HTML
```

---

### 步骤 3️⃣：HTML样式布局代码规划与生成

**🎯 目标**：根据步骤2生成的幻灯片页面清单，为每页规划对应的HTML样式、布局、图文、图表代码，并生成完整的McKinsey风格HTML文件。

**⚠️ 核心原则**：
- ✅ 100%基于步骤2的页面清单进行代码规划
- ✅ 每页都必须选择最佳的示例模板并基于其生成代码
- ✅ 严格遵循McKinsey设计系统和HTML最佳实践
- ✅ 遇到内容过多时，使用"继续"机制分批生成
- ❌ 绝对禁止为了省token而压缩、省略、简化代码

---

#### 📋 步骤3执行流程（4个子步骤）

```
步骤3.1：准备阶段（读取必读资源）
  ↓
步骤3.2：为每页规划HTML代码方案
  ↓
步骤3.3：生成完整HTML文件
  ↓
步骤3.4：验证代码完整性与质量
```

---

##### 步骤 3.1：准备阶段（⚠️ 不可跳过）

**🎯 目标**：读取所有必读资源，建立代码生成的知识基础。

**⚠️ 强制要求：必须读取并参考以下资源**

###### 必读资源清单

**资源组1：设计规范与最佳实践**

```bash
# 必须执行以下读取操作
Read: beauty-html/references/best-practices.md
Read: beauty-html/references/mckinsey-design-system.md
Read: beauty-html/references/template-guide.md
```

从这些资源学习：
- McKinsey标准配色方案（CSS变量定义）
- 排版层次规范（字体大小、行高、间距）
- HTML最佳实践（语义化、可访问性、性能）
- 内容完整性原则（不总结、不篡改、不添加）

**资源组2：模板与示例**

```bash
# 必须执行以下读取操作
Read: beauty-html/assets/presentation-template.html
Read: beauty-html/assets/TEMPLATE_USAGE_GUIDE.md
Read: beauty-html/assets/INDEX.md
```

从这些资源学习：
- 完整HTML文档结构
- 导航功能实现方法
- 所有可用的示例页面类型
- 示例匹配决策树

**资源组3：图表选择指南**

```bash
# 必须执行以下读取操作
Read: beauty-html/references/chart-selection-guide.md
Read: beauty-html/assets/CHART_EXAMPLES_INDEX.md
Read: beauty-html/assets/INSIGHT_VISUALIZATION_GUIDE.md
```

从这些资源学习：
- 9种内容结构类型的识别方法
- 图表选择的决策树
- 所有可用的图表类型清单
- 观点与可视化的映射关系

**⚠️ Token限制处理：如果资源文件很长**

```
如果某个资源文件超过5000字，必须分批读取：

阶段1a：读取前半部分资源
├─ 读取 best-practices.md 前半部分
├─ 记录核心原则和规范
└─ 输出："步骤3.1阶段1a完成 - 已读取前半部分资源
       请输入'继续'以读取剩余部分"

【等待用户输入"继续"】

阶段1b：读取后半部分资源
├─ 读取 best-practices.md 后半部分
├─ 记录完整的规范清单
└─ 输出："步骤3.1阶段1b完成 - 资源100%读取完成
       已进入步骤3.2"
```

**输出产物**：

- McKinsey配色方案清单（CSS变量）
- 排版规范清单（字体大小、行高）
- HTML模板结构（基础框架）
- 示例页面类型清单（14种示例）
- 图表选择决策树（9种内容类型）

**验证标准**：

- [ ] 所有必读资源已读取
- [ ] 配色方案已记录
- [ ] 排版规范已记录
- [ ] 示例清单已了解
- [ ] 图表决策树已掌握

---

##### 步骤 3.2：为每页规划HTML代码方案

**🎯 目标**：基于步骤2的页面清单，为每一页幻灯片规划具体的HTML代码方案，包括布局类型、示例模板、图表类型、CSS样式、JavaScript代码。

**执行要求**：

为每一页幻灯片创建详细的代码规划方案，包含：
- 页面编号
- 页面标题
- 内容摘要（来自步骤2）
- 布局类型（L1-L12）
- 匹配的示例模板
- 需要的图表类型（如有）
- CSS样式清单
- JavaScript代码清单
- 代码生成要点

**执行流程**：

###### 阶段1：为封面页和目录页规划代码

```markdown
===== 页面 1：封面页 - 代码规划 =====
页面类型：P1 - Cover Page
页面标题：[文档标题]

内容摘要（来自步骤2）：
- 主标题：[完整标题]
- 副标题：[副标题]
- 日期：[日期]

布局类型：L1 - 单列布局

示例模板匹配：
1. 分析页面特征：
   - 内容类型：概念性
   - 观点数量：1个（封面信息）
   - 数据密度：无
   - 对比关系：无

2. 读取示例索引：
   Read: beauty-html/assets/INDEX.md
   找到匹配：01-cover-page.html

3. 计算匹配度：
   - 观点数量匹配：✓ 封面页完美匹配 (40%)
   - 数据密度匹配：✓ 无数据匹配 (30%)
   - 对比关系匹配：✓ 无对比匹配 (20%)
   - 特殊场景匹配：✓ 封面场景匹配 (10%)
   → 总计：100%

4. 选择示例：01-cover-page.html (100%匹配)

5. 读取示例文件：
   Read: beauty-html/assets/01-cover-page.html

需要的图表：无

CSS样式清单：
- .slide.title-slide（封面页容器）
- .title-main（主标题，64px，粗体，黑色）
- .subtitle（副标题，36px，粗体，橙色）
- .date-info（日期信息，20px，灰色）

HTML结构：
  <div class="slide title-slide active">
    <h1 class="title-main">[文档标题]</h1>
    <p class="subtitle">[副标题]</p>
    <p class="date-info">[日期]</p>
  </div>

JavaScript代码：无特殊要求

代码生成要点：
- 从01-cover-page.html复制完整的CSS样式
- 保持McKinsey配色方案
- 替换占位符为实际内容
- 确保响应式设计


===== 页面 2：目录页 - 代码规划 =====
页面类型：P2 - Table of Contents
页面标题：目录

内容摘要（来自步骤2）：
1. [第一章标题]
2. [第二章标题]
3. [第三章标题]
（共3个章节）

布局类型：L8 - 目录页布局

示例模板匹配：
1. 分析页面特征：
   - 内容类型：概念性
   - 观点数量：3个章节
   - 数据密度：无
   - 对比关系：并列

2. 读取示例索引：
   从INDEX.md中找到：
   - 08-table-of-contents.html（列表式，适合≤6章节）
   - 10-toc-grid-cards.html（网格式，适合4-6章节）

3. 计算匹配度：
   示例1: 10-toc-grid-cards.html (85%)
   ├─ 观点数量匹配：✓ 3个章节适合网格 (35%)
   ├─ 数据密度匹配：✓ 无数据匹配 (30%)
   ├─ 对比关系匹配：✓ 并列关系匹配 (20%)
   └─ 特殊场景匹配：- 无特殊场景 (0%)
   
   示例2: 08-table-of-contents.html (80%)
   ├─ 观点数量匹配：✓ 3个章节适合列表 (40%)
   ├─ 数据密度匹配：✓ 无数据匹配 (30%)
   ├─ 对比关系匹配：○ 列表式部分匹配 (10%)
   └─ 特殊场景匹配：- 无特殊场景 (0%)

4. 选择示例：10-toc-grid-cards.html (85%匹配)

5. 读取示例文件：
   Read: beauty-html/assets/10-toc-grid-cards.html

需要的图表：无

CSS样式清单：
- .toc-grid（目录网格容器）
- .toc-card（目录卡片）
- .chapter-number（章节编号）
- .chapter-title（章节标题）

HTML结构：
  <div class="slide">
    <h2 class="slide-title">目录</h2>
    <div class="slide-content">
      <div class="toc-grid">
        <div class="toc-card">
          <div class="chapter-number">01</div>
          <h3 class="chapter-title">[第一章标题]</h3>
        </div>
        <div class="toc-card">
          <div class="chapter-number">02</div>
          <h3 class="chapter-title">[第二章标题]</h3>
        </div>
        <div class="toc-card">
          <div class="chapter-number">03</div>
          <h3 class="chapter-title">[第三章标题]</h3>
        </div>
      </div>
    </div>
  </div>

JavaScript代码：无特殊要求

代码生成要点：
- 从10-toc-grid-cards.html复制完整CSS
- 使用网格布局（grid-template-columns: repeat(auto-fit, minmax(280px, 1fr))）
- 保持卡片hover效果
- 确保响应式（移动端自动转为单列）
```

###### 阶段2：为章节首页规划代码

```markdown
===== 页面 3：第一章章节首页 - 代码规划 =====
页面类型：P3 - Chapter Cover
页面标题：第一章 - [章节标题]

内容摘要（来自步骤2）：
- 章节编号：01
- 章节标题：[完整标题]
- 章节描述：[描述]
- 子章节导航：1.1, 1.2, 1.3

布局类型：L1 - 单列布局

示例模板匹配：
1. 分析页面特征：
   - 内容类型：概念性
   - 观点数量：1个（章节概览）
   - 数据密度：无
   - 对比关系：无

2. 读取示例索引：
   从INDEX.md中找到：11-chapter-overview.html

3. 计算匹配度：
   示例: 11-chapter-overview.html (95%)
   ├─ 观点数量匹配：✓ 章节概览完美匹配 (40%)
   ├─ 数据密度匹配：✓ 无数据匹配 (30%)
   ├─ 对比关系匹配：✓ 无对比匹配 (20%)
   └─ 特殊场景匹配：✓ 章节首页场景 (10%)

4. 选择示例：11-chapter-overview.html (95%匹配)

5. 读取示例文件：
   Read: beauty-html/assets/11-chapter-overview.html

需要的图表：无

CSS样式清单：
- .slide.section-slide（章节首页容器）
- .chapter-number（章节编号，大号显示）
- .chapter-title（章节标题）
- .chapter-description（章节描述）
- .sub-chapter-list（子章节列表）

HTML结构：
  <div class="slide section-slide">
    <div class="chapter-number">01</div>
    <h1 class="chapter-title">[章节标题]</h1>
    <p class="chapter-description">[章节描述]</p>
    <ul class="sub-chapter-list">
      <li>1.1 [子章节标题]</li>
      <li>1.2 [子章节标题]</li>
      <li>1.3 [子章节标题]</li>
    </ul>
  </div>

JavaScript代码：无特殊要求

代码生成要点：
- 从11-chapter-overview.html复制完整CSS
- 章节编号使用大字体（72px）和橙色
- 保持视觉层次清晰
- 确保响应式设计
```

###### 阶段3：为内容页规划代码（最重要）

```markdown
===== 页面 6：内容页 - 行业现状 - 代码规划 =====
页面类型：P4 - Content Page
页面标题：1.1 行业现状

内容摘要（来自步骤2）：
1. 市场规模达到500亿
2. 用户增长率15%
3. 头部平台占据65%份额
（共3个要点，包含4个数据点）

布局类型：L3 - 三列布局

示例模板匹配：
1. 分析页面特征：
   - 内容类型：概念性 + 数据性（混合）
   - 观点数量：3个并列要点
   - 数据密度：中等（4个数据点）
   - 对比关系：并列关系

2. 读取示例索引：
   从INDEX.md中找到：
   - 03-three-column.html（三列并列）
   - 06-data-emphasis.html（数字强调）

3. 计算匹配度：
   示例1: 03-three-column.html (90%)
   ├─ 观点数量匹配：✓ 3个完美匹配 (40%)
   ├─ 数据密度匹配：✓ 中等数据匹配 (30%)
   ├─ 对比关系匹配：✓ 并列关系匹配 (20%)
   └─ 特殊场景匹配：- 无特殊场景 (0%)
   
   示例2: 06-data-emphasis.html (75%)
   ├─ 观点数量匹配：○ 3个（建议2-4个）(30%)
   ├─ 数据密度匹配：✓ 数字强调匹配 (30%)
   ├─ 对比关系匹配：○ 并列部分匹配 (15%)
   └─ 特殊场景匹配：- 无特殊场景 (0%)

4. 选择示例：03-three-column.html (90%匹配)

5. 读取示例文件：
   Read: beauty-html/assets/03-three-column.html

需要的图表：无（纯文本+数据点）

CSS样式清单：
- .three-column-layout（三列容器）
- .column（单列样式）
- .data-point（数据点高亮）
- .number-highlight（数字强调）

HTML结构：
  <div class="slide">
    <h2 class="slide-title">1.1 行业现状</h2>
    <div class="slide-content">
      <div class="three-column-layout">
        <div class="column">
          <h3>市场规模</h3>
          <div class="number-highlight">500亿元</div>
          <p>知识付费行业近年来快速发展，2024年市场规模突破500亿元人民币，年复合增长率保持在20%以上。</p>
        </div>
        <div class="column">
          <h3>用户增长</h3>
          <div class="number-highlight">15%</div>
          <p>付费用户数量持续增长，2024年增长率为15%，用户付费意愿显著提升。</p>
        </div>
        <div class="column">
          <h3>市场集中度</h3>
          <div class="number-highlight">65%</div>
          <p>市场集中度较高，前10大平台占据65%市场份额，长尾平台生存空间有限。</p>
        </div>
      </div>
    </div>
  </div>

JavaScript代码：无特殊要求

代码生成要点：
- 从03-three-column.html复制完整CSS
- 使用grid布局（grid-template-columns: repeat(3, 1fr)）
- 数字使用大字体（42px）和橙色高亮
- 每列添加渐变色背景（紫色、粉色、蓝色）
- 保持卡片hover效果
- 响应式：平板/手机自动转为单列

---

===== 页面 7：内容页 - 竞争格局 - 代码规划 =====
页面类型：P4 - Content Page
页面标题：1.2 竞争格局

内容摘要（来自步骤2）：
1. 平台A估值14-21亿美元
2. 平台B估值150-200万美元
3. 估值差距10-20倍
4. 内容质量是关键
（共4个要点，包含3个数据点，需要1个对比图表）

布局类型：L5 - 图表+文本布局

示例模板匹配：
1. 分析页面特征：
   - 内容类型：数据性（包含对比图表）
   - 观点数量：4个要点
   - 数据密度：大量（3个数据点 + 1个图表）
   - 对比关系：对比关系（平台A vs 平台B）

2. 读取示例索引：
   从INDEX.md中找到：05-chart-text.html

3. 计算匹配度：
   示例: 05-chart-text.html (95%)
   ├─ 观点数量匹配：✓ 4个要点适合 (40%)
   ├─ 数据密度匹配：✓ 包含图表匹配 (30%)
   ├─ 对比关系匹配：✓ 对比场景匹配 (20%)
   └─ 特殊场景匹配：✓ 数据可视化场景 (5%)

4. 选择示例：05-chart-text.html (95%匹配)

5. 读取示例文件：
   Read: beauty-html/assets/05-chart-text.html

需要的图表：
- 图表类型：对比柱状图（Bar Chart）
- 图表库：Chart.js
- 数据：平台A估值 vs 平台B估值

图表选择依据：
- 内容结构类型：对比型（关键词：对比、差异、vs）
- 根据chart-selection-guide.md → 对比型 → 条形图/柱状图
- 从CHART_EXAMPLES_INDEX.md确认：Chart.js bar chart

CSS样式清单：
- .chart-text-layout（图表+文本容器）
- .chart-container（图表容器，50-70%宽度）
- .text-content（文本内容，30-50%宽度）
- .key-insights（关键洞察列表）

HTML结构：
  <div class="slide">
    <h2 class="slide-title">1.2 竞争格局</h2>
    <div class="slide-content">
      <div class="chart-text-layout">
        <div class="chart-container">
          <canvas id="chartCompetition"></canvas>
        </div>
        <div class="text-content">
          <h3>关键发现</h3>
          <ul class="key-insights">
            <li>平台A估值14-21亿美元，头部平台估值水平较高</li>
            <li>平台B估值150-200万美元，中小平台估值差异巨大</li>
            <li>估值差距达到10-20倍，马太效应显著</li>
            <li>内容质量是核心竞争力，直接影响用户留存</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

JavaScript代码：
  // 在DOMContentLoaded中初始化图表
  document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('chartCompetition').getContext('2d');
    
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['平台A', '平台B'],
        datasets: [{
          label: '估值（美元）',
          data: [180000000, 1750000], // 18亿 vs 175万（取中值）
          backgroundColor: ['#F85d42', '#556EE6']
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          title: {
            display: true,
            text: '头部平台vs中小平台估值对比',
            font: { size: 18, weight: 'bold' },
            color: '#000000',
            padding: { bottom: 20 }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '$' + (value / 1000000).toFixed(0) + 'M';
              },
              font: { size: 12 },
              color: '#333333'
            },
            grid: {
              color: '#e0e0e0',
              drawBorder: false
            }
          },
          x: {
            ticks: {
              font: { size: 12 },
              color: '#333333'
            },
            grid: {
              display: false
            }
          }
        }
      }
    });
  });

代码生成要点：
- 从05-chart-text.html复制完整CSS
- 图表容器必须包含width: 100% !important
- 图表高度设置为500px
- Chart.js配置必须包含responsive: true和maintainAspectRatio: false
- 使用McKinsey配色（橙色#F85d42和蓝色#556EE6）
- 响应式：平板/手机改为纵向布局（图表在上，文本在下）
```

###### 阶段4：为复杂内容页规划代码（分页场景）

```markdown
===== 页面 9：内容页 - 六大平台启示（第1部分）- 代码规划 =====
页面类型：P4 - Content Page
页面标题：2.2 六大平台启示 - 第1部分

内容摘要（来自步骤2）：
1. 得到 - 知识服务
2. 喜马拉雅 - 音频内容
3. 知乎 - 社区问答
4. 樊登读书 - 读书服务
5. 混沌学园 - 商学教育
6. 蜻蜓FM - 广播电台
（共6个要点，第1页）

布局类型：L4 - 卡片网格布局

示例模板匹配：
1. 分析页面特征：
   - 内容类型：概念性
   - 观点数量：6个并列要点
   - 数据密度：无
   - 对比关系：并列关系

2. 读取示例索引：
   从INDEX.md中找到：04-card-grid.html

3. 计算匹配度：
   示例: 04-card-grid.html (95%)
   ├─ 观点数量匹配：✓ 6个完美匹配（4-6范围）(40%)
   ├─ 数据密度匹配：✓ 无数据匹配 (30%)
   ├─ 对比关系匹配：✓ 并列关系匹配 (20%)
   └─ 特殊场景匹配：✓ 多要点场景 (5%)

4. 选择示例：04-card-grid.html (95%匹配)

5. 读取示例文件：
   Read: beauty-html/assets/04-card-grid.html

需要的图表：无

CSS样式清单：
- .highlight-cards（卡片网格容器）
- .highlight-card（单个卡片）
- .card-title（卡片标题）
- .card-content（卡片内容）

HTML结构：
<div class="slide">
  <h2 class="slide-title">2.2 六大平台启示 - 第1部分</h2>
  <div class="slide-content">
    <div class="highlight-cards">
      <div class="highlight-card">
        <h4 class="card-title">得到</h4>
        <p class="card-subtitle">知识服务</p>
        <ul class="card-content">
          <li>定位：精品知识服务平台</li>
          <li>核心：严选课程+音频书</li>
          <li>启示：内容质量>数量</li>
        </ul>
      </div>
      <div class="highlight-card">
        <h4 class="card-title">喜马拉雅</h4>
        <p class="card-subtitle">音频内容</p>
        <ul class="card-content">
          <li>定位：综合音频平台</li>
          <li>核心：海量内容+UGC</li>
          <li>启示：内容丰富度很重要</li>
        </ul>
      </div>
      <!-- ...其他4个卡片... -->
    </div>
  </div>
</div>

JavaScript代码：无特殊要求

代码生成要点：
- 从04-card-grid.html复制完整CSS
- 使用grid布局（grid-template-columns: repeat(auto-fit, minmax(280px, 1fr))）
- 充分利用横向空间，2x3网格布局
- 每个卡片添加border-top: 4px solid橙色
- 保持卡片hover效果（阴影加深）
- 响应式：平板2列，手机1列

**⚠️ Token限制处理：如果页面很多**

如果幻灯片页面超过20页，必须分批规划：

阶段3a：规划前10页的代码方案
├─ 详细规划封面页、目录页、章节首页、前7页内容页
├─ 为每页选择示例模板并计算匹配度
├─ 列出所有CSS、HTML、JavaScript代码要点
└─ 输出："步骤3.2阶段3a完成 - 已规划前10页代码方案
       请输入'继续'以规划剩余页面"

【等待用户输入"继续"】

阶段3b：规划剩余页面的代码方案
├─ 详细规划剩余内容页和结束页
├─ 为每页选择示例模板并计算匹配度
├─ 列出所有CSS、HTML、JavaScript代码要点
└─ 输出："步骤3.2阶段3b完成 - 所有页面代码方案规划完成
       总页数：N页
       已进入步骤3.3"
```
**输出产物**：

- 每页的代码规划方案（包含布局、示例、CSS、HTML、JS）
- 示例模板匹配清单（每页对应的示例文件）
- 图表类型清单（需要的所有图表及其配置）
- CSS样式汇总（所有需要的CSS类）
- JavaScript代码汇总（所有图表初始化代码）

**验证标准**：

- [ ] 所有页面已规划代码方案
- [ ] 每页都有匹配的示例模板
- [ ] 图表类型选择合理
- [ ] CSS样式清单完整
- [ ] JavaScript代码清单完整
- [ ] 无页面遗漏

---

##### 步骤 3.3：生成完整HTML文件

**🎯 目标**：基于步骤3.2的代码规划方案，生成完整的、可运行的McKinsey风格HTML文件。

**执行要求**：

按照固定的4个阶段顺序生成HTML代码：
1. 阶段1：生成HTML框架和完整CSS样式
2. 阶段2：生成前半部分幻灯片
3. 阶段3：生成后半部分幻灯片
4. 阶段4：生成JavaScript代码和结束标签

**⚠️ 关键原则**：
- ✅ 每个阶段的代码必须是完整的语法单元
- ✅ CSS必须在阶段1一次性完整生成
- ✅ 每个幻灯片的HTML必须完整
- ✅ JavaScript必须在阶段4完整生成
- ✅ 每个阶段结束后提示用户输入"继续"
- ❌ 禁止跨阶段截断HTML标签
- ❌ 禁止省略CSS样式
- ❌ 禁止简化图表代码

---

###### 阶段1：生成HTML框架和完整CSS样式

**执行流程**：

```markdown
✅ 阶段1/4：生成HTML框架和完整CSS样式

生成内容：
1. DOCTYPE声明和HTML根元素
2. head标签和meta设置
3. Chart.js CDN引用
4. 完整的CSS样式（约600-800行）
5. body开始标签
6. 导航栏结构
7. 幻灯片容器开始标签
```

**生成代码示例**：

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>[文档标题] - McKinsey风格演示文稿</title>
  
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <style>
    /* ========================================
       McKinsey Design System - CSS Variables
       ======================================== */
    :root {
      /* 配色方案 */
      --color-bg: #FFFFFF;
      --color-text-primary: #000000;
      --color-text-secondary: #333333;
      --color-accent-primary: #F85d42;
      --color-accent-secondary: #74788d;
      --color-blue: #556EE6;
      --color-green: #34c38f;
      --color-light-blue: #50a5f1;
      --color-yellow: #f1b44c;
      
      /* 字体大小 */
      --font-size-title-main: 64px;
      --font-size-title-section: 48px;
      --font-size-title-slide: 42px;
      --font-size-subtitle: 36px;
      --font-size-body-primary: 20px;
      --font-size-body-secondary: 16px;
      
      /* 间距 */
      --spacing-xs: 10px;
      --spacing-sm: 20px;
      --spacing-md: 30px;
      --spacing-lg: 40px;
      --spacing-xl: 60px;
    }
    
    /* ========================================
       Base Styles
       ======================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--color-bg);
      color: var(--color-text-secondary);
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    /* ========================================
       Navigation Bar
       ======================================== */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: white;
      border-bottom: 2px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 var(--spacing-xl);
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .navbar h1 {
      font-size: 24px;
      font-weight: 700;
      color: var(--color-text-primary);
    }
    
    .nav-controls {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .nav-btn {
      padding: 12px 24px;
      background: var(--color-accent-primary);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .nav-btn:hover {
      background: #d94a2f;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(248, 93, 66, 0.3);
    }
    
    .nav-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .slide-counter {
      font-size: 18px;
      font-weight: 600;
      color: var(--color-text-secondary);
      padding: 0 var(--spacing-sm);
    }
    
    /* ========================================
       Presentation Container
       ======================================== */
    .presentation-container {
      margin-top: 80px;
      width: 100%;
      min-height: calc(100vh - 80px);
    }
    
    /* ========================================
       Slide Base Styles
       ======================================== */
    .slide {
      display: none;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--spacing-xl);
      min-height: calc(100vh - 80px);
      animation: fadeIn 0.5s ease-in-out;
    }
    
    .slide.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .slide-title {
      font-size: var(--font-size-title-slide);
      font-weight: 700;
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-md);
      border-bottom: 3px solid var(--color-accent-primary);
      padding-bottom: var(--spacing-sm);
    }
    
    .slide-content {
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* ========================================
       Cover Page (P1)
       ======================================== */
    .slide.title-slide {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .title-main {
      font-size: var(--font-size-title-main);
      font-weight: 700;
      margin-bottom: var(--spacing-md);
      line-height: 1.2;
    }
    
    .subtitle {
      font-size: var(--font-size-subtitle);
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: var(--spacing-sm);
    }
    
    .date-info {
      font-size: var(--font-size-body-primary);
      color: rgba(255, 255, 255, 0.8);
    }
    
    /* ========================================
       Chapter Cover (P3)
       ======================================== */
    .slide.section-slide {
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding-left: 100px;
    }
    
    .chapter-number {
      font-size: 72px;
      font-weight: 700;
      color: var(--color-accent-primary);
      margin-bottom: var(--spacing-sm);
    }
    
    .chapter-title {
      font-size: var(--font-size-title-section);
      font-weight: 700;
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-md);
    }
    
    .chapter-description {
      font-size: var(--font-size-body-primary);
      color: var(--color-text-secondary);
      margin-bottom: var(--spacing-lg);
      max-width: 800px;
    }
    
    .sub-chapter-list {
      list-style: none;
      font-size: var(--font-size-body-primary);
      color: var(--color-text-secondary);
    }
    
    .sub-chapter-list li {
      padding: var(--spacing-sm) 0;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .sub-chapter-list li:before {
      content: "→ ";
      color: var(--color-accent-primary);
      font-weight: 700;
      margin-right: var(--spacing-xs);
    }
    
    /* ========================================
       Table of Contents (P2) - Grid Cards
       ======================================== */
    .toc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }
    
    .toc-card {
      background: white;
      padding: var(--spacing-lg);
      border-radius: 12px;
      border-left: 6px solid var(--color-accent-primary);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .toc-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    
    .chapter-number-small {
      font-size: 36px;
      font-weight: 700;
      color: var(--color-accent-primary);
      margin-bottom: var(--spacing-sm);
    }
    
    .toc-card h3 {
      font-size: 24px;
      font-weight: 700;
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-xs);
    }
    
    /* ========================================
       Three Column Layout (L3)
       ======================================== */
    .three-column-layout {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }
    
    .three-column-layout .column {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      padding: var(--spacing-md);
      border-radius: 12px;
      border-left: 4px solid var(--color-accent-primary);
      transition: all 0.3s ease;
    }
    
    .three-column-layout .column:nth-child(1) {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .three-column-layout .column:nth-child(2) {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }
    
    .three-column-layout .column:nth-child(3) {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
    }
    
    .three-column-layout .column:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    .three-column-layout .column h3 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
    }
    
    .number-highlight {
      font-size: 42px;
      font-weight: 700;
      margin: var(--spacing-sm) 0;
    }
    
    /* ========================================
       Card Grid Layout (L4)
       ======================================== */
    .highlight-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--spacing-md);
      margin: var(--spacing-lg) 0;
    }
    
    .highlight-card {
      background: white;
      padding: var(--spacing-md);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-top: 4px solid var(--color-accent-primary);
      transition: all 0.3s ease;
    }
    
    .highlight-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    
    .card-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-xs);
    }
    
    .card-subtitle {
      font-size: 16px;
      font-weight: 600;
      color: var(--color-accent-primary);
      margin-bottom: var(--spacing-sm);
    }
    
    .card-content {
      list-style: none;
      font-size: 16px;
      color: var(--color-text-secondary);
    }
    
    .card-content li {
      padding: 6px 0;
      padding-left: 20px;
      position: relative;
    }
    
    .card-content li:before {
      content: "•";
      color: var(--color-accent-primary);
      font-weight: 700;
      position: absolute;
      left: 0;
    }
    
    /* ========================================
       Chart + Text Layout (L5)
       ======================================== */
    .chart-text-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-lg);
      align-items: center;
      margin: var(--spacing-lg) 0;
    }
    
    .chart-container {
      position: relative;
      width: 100% !important;
      min-width: 300px !important;
      max-width: 100% !important;
      height: 500px;
      margin: var(--spacing-lg) 0;
      background: white;
      padding: var(--spacing-md);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      box-sizing: border-box;
    }
    
    .chart-container canvas {
      width: 100% !important;
      height: 100% !important;
      display: block !important;
    }
    
    .text-content {
      padding: var(--spacing-md);
    }
    
    .text-content h3 {
      font-size: 28px;
      font-weight: 700;
      color: var(--color-text-primary);
      margin-bottom: var(--spacing-sm);
    }
    
    .key-insights {
      list-style: none;
      font-size: var(--font-size-body-primary);
      color: var(--color-text-secondary);
    }
    
    .key-insights li {
      padding: var(--spacing-sm) 0;
      padding-left: 30px;
      position: relative;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .key-insights li:before {
      content: "✓";
      color: var(--color-green);
      font-weight: 700;
      font-size: 20px;
      position: absolute;
      left: 0;
    }
    
    /* ========================================
       Bullet List
       ======================================== */
    .bullet-list {
      list-style: none;
      font-size: var(--font-size-body-primary);
      color: var(--color-text-secondary);
      margin: var(--spacing-md) 0;
    }
    
    .bullet-list li {
      padding: var(--spacing-sm) 0;
      padding-left: 30px;
      position: relative;
    }
    
    .bullet-list li:before {
      content: "•";
      color: var(--color-accent-primary);
      font-weight: 700;
      font-size: 24px;
      position: absolute;
      left: 0;
    }
    
    /* ========================================
       Emphasis Box
       ======================================== */
    .emphasis-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: var(--spacing-lg);
      border-radius: 12px;
      margin: var(--spacing-lg) 0;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .emphasis-box h3 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
    }
    
    .emphasis-box p {
      font-size: var(--font-size-body-primary);
      line-height: 1.8;
    }
    
    /* ========================================
       Fullscreen Button
       ======================================== */
    .fullscreen-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      background: var(--color-accent-primary);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(248, 93, 66, 0.3);
      transition: all 0.3s ease;
      z-index: 999;
    }
    
    .fullscreen-btn:hover {
      background: #d94a2f;
      transform: scale(1.1);
    }
    
    /* ========================================
       Responsive Design
       ======================================== */
    @media (max-width: 1024px) {
      .navbar {
        padding: 0 var(--spacing-md);
      }
      
      .slide {
        padding: var(--spacing-md);
      }
      
      .title-main {
        font-size: 48px;
      }
      
      .three-column-layout {
        grid-template-columns: 1fr;
      }
      
      .chart-text-layout {
        grid-template-columns: 1fr;
      }
      
      .chart-container {
        height: 400px;
        padding: var(--spacing-sm);
      }
      
      .highlight-cards {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      .navbar h1 {
        font-size: 18px;
      }
      
      .nav-btn {
        padding: 10px 16px;
        font-size: 14px;
      }
      
      .slide-counter {
        font-size: 14px;
      }
      
      .title-main {
        font-size: 36px;
      }
      
      .slide-title {
        font-size: 32px;
      }
      
      .chart-container {
        height: 300px;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <h1>[文档标题]</h1>
    <div class="nav-controls">
      <button class="nav-btn" id="prevBtn" onclick="previousSlide()">← 上一页</button>
      <span class="slide-counter">
        <span id="currentSlide">1</span> / <span id="totalSlides">12</span>
      </span>
      <button class="nav-btn" id="nextBtn" onclick="nextSlide()">下一页 →</button>
    </div>
  </nav>
  
  <!-- Presentation Container -->
  <div class="presentation-container">
```

**阶段1输出模板**：

```
✅ 阶段1/4完成：HTML框架和CSS样式已生成

已生成内容：
✅ DOCTYPE 和 HTML 根元素
✅ head 标签和 meta 设置
✅ Chart.js CDN 引用（v4.4.0）
✅ 完整的 CSS 样式（约800行）
   - McKinsey配色方案（9种颜色）
   - 排版层次规范（6种字体大小）
   - 导航栏样式
   - 幻灯片基础样式
   - 封面页样式（P1）
   - 章节首页样式（P3）
   - 目录页样式（P2）
   - 三列布局样式（L3）
   - 卡片网格样式（L4）
   - 图表+文本布局样式（L5）
   - 响应式设计（1024px、768px断点）
✅ body 开始标签
✅ 导航栏结构
✅ 幻灯片容器开始标签

进度：30%完成

【请输入"继续"以生成前半部分幻灯片内容】
```

---

###### 阶段5：生成前半部分幻灯片

**执行流程**：

```markdown
✅ 阶段2/4：生成前半部分幻灯片（页面1-6）

生成内容：
1. 封面页（页面1）
2. 目录页（页面2）
3. 第一章章节首页（页面3）
4. 第二章章节首页（页面4）
5. 第三章章节首页（页面5）
6. 内容页 - 行业现状（页面6）

⚠️ 每页必须包含完整的HTML结构
⚠️ 确保所有内容和数据100%准确
⚠️ 基于步骤3.2的代码规划方案生成
```

**生成代码示例**：

```html
    <!-- ==========================================
         页面 1：封面页
         ========================================== -->
    <div class="slide title-slide active">
      <h1 class="title-main">知识付费平台分析报告</h1>
      <p class="subtitle">市场分析与战略建议</p>
      <p class="date-info">2024年</p>
    </div>
    
    <!-- ==========================================
         页面 2：目录页
         ========================================== -->
    <div class="slide">
      <h2 class="slide-title">目录</h2>
      <div class="slide-content">
        <div class="toc-grid">
          <div class="toc-card">
            <div class="chapter-number-small">01</div>
            <h3>市场概况</h3>
          </div>
          <div class="toc-card">
            <div class="chapter-number-small">02</div>
            <h3>平台分析</h3>
          </div>
          <div class="toc-card">
            <div class="chapter-number-small">03</div>
            <h3>核心建议</h3>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ==========================================
         页面 3：第一章章节首页
         ========================================== -->
    <div class="slide section-slide">
      <div class="chapter-number">01</div>
      <h1 class="chapter-title">市场概况</h1>
      <p class="chapter-description">分析知识付费行业的整体现状和竞争格局</p>
      <ul class="sub-chapter-list">
        <li>1.1 行业现状</li>
        <li>1.2 竞争格局</li>
      </ul>
    </div>
    
    <!-- ==========================================
         页面 4：第二章章节首页
         ========================================== -->
    <div class="slide section-slide">
      <div class="chapter-number">02</div>
      <h1 class="chapter-title">平台分析</h1>
      <p class="chapter-description">深入分析主流平台的商业模式和核心启示</p>
      <ul class="sub-chapter-list">
        <li>2.1 商业模式</li>
        <li>2.2 六大平台启示</li>
      </ul>
    </div>
    
    <!-- ==========================================
         页面 5：第三章章节首页
         ========================================== -->
    <div class="slide section-slide">
      <div class="chapter-number">03</div>
      <h1 class="chapter-title">核心建议</h1>
      <p class="chapter-description">基于市场分析提出的战略建议</p>
      <ul class="sub-chapter-list">
        <li>3.1 战略建议</li>
      </ul>
    </div>
    
    <!-- ==========================================
         页面 6：内容页 - 1.1 行业现状
         ========================================== -->
    <div class="slide">
      <h2 class="slide-title">1.1 行业现状</h2>
      <div class="slide-content">
        <div class="three-column-layout">
          <div class="column">
            <h3>市场规模</h3>
            <div class="number-highlight">500亿元</div>
            <p>知识付费行业近年来快速发展，2024年市场规模突破500亿元人民币，年复合增长率保持在20%以上。</p>
          </div>
          <div class="column">
            <h3>用户增长</h3>
            <div class="number-highlight">15%</div>
            <p>付费用户数量持续增长，2024年增长率为15%，用户付费意愿显著提升。</p>
          </div>
          <div class="column">
            <h3>市场集中度</h3>
            <div class="number-highlight">65%</div>
            <p>市场集中度较高，前10大平台占据65%市场份额，长尾平台生存空间有限。</p>
          </div>
        </div>
      </div>
    </div>
```

**阶段2输出模板**：

```
✅ 阶段2/4完成：前半部分幻灯片已生成（页面1-6）

已生成内容：
✅ 页面 1：封面页（基于01-cover-page.html，100%匹配）
✅ 页面 2：目录页（基于10-toc-grid-cards.html，85%匹配）
✅ 页面 3：第一章章节首页（基于11-chapter-overview.html，95%匹配）
✅ 页面 4：第二章章节首页（基于11-chapter-overview.html，95%匹配）
✅ 页面 5：第三章章节首页（基于11-chapter-overview.html，95%匹配）
✅ 页面 6：内容页 - 行业现状（基于03-three-column.html，90%匹配）
   - 使用三列布局
   - 包含3个数据点（500亿、15%、65%）
   - 使用渐变色背景
   - 包含hover效果

进度：60%完成

【请输入"继续"以生成后半部分幻灯片内容】
```

---

###### 阶段6：生成后半部分幻灯片

**执行流程**：

```markdown
✅ 阶段3/4：生成后半部分幻灯片（页面7-12）

生成内容：
7. 内容页 - 竞争格局（包含图表）
8. 内容页 - 商业模式
9. 内容页 - 六大平台启示（第1部分）
10. 内容页 - 六大平台启示（第2部分）
11. 内容页 - 战略建议
12. 结束页

⚠️ 每页必须包含完整的HTML结构
⚠️ 页面7包含Chart.js图表，确保canvas ID唯一
⚠️ 确保所有内容和数据100%准确
```

**生成代码示例**：

```html
    <!-- ==========================================
         页面 7：内容页 - 1.2 竞争格局（包含图表）
         ========================================== -->
    <div class="slide">
      <h2 class="slide-title">1.2 竞争格局</h2>
      <div class="slide-content">
        <div class="chart-text-layout">
          <div class="chart-container">
            <canvas id="chartCompetition"></canvas>
          </div>
          <div class="text-content">
            <h3>关键发现</h3>
            <ul class="key-insights">
              <li>平台A估值14-21亿美元，头部平台估值水平较高，已完成多轮融资</li>
              <li>平台B估值150-200万美元，中小平台估值差异巨大，融资困难，盈利压力大</li>
              <li>估值差距达到10-20倍，马太效应显著，资源向头部平台集中</li>
              <li>内容质量是核心竞争力，直接影响用户留存，头部平台在内容生产上投入巨大</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ==========================================
         页面 8：内容页 - 2.1 商业模式
         ========================================== -->
    <div class="slide">
      <h2 class="slide-title">2.1 商业模式</h2>
      <div class="slide-content">
        <div class="highlight-cards">
          <div class="highlight-card">
            <h4 class="card-title">订阅制</h4>
            <p class="card-subtitle">稳定现金流模式</p>
            <ul class="card-content">
              <li>用户按月/年订阅获取内容</li>
              <li>稳定的现金流收入</li>
              <li>代表平台：得到、樊登读书</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">单次付费</h4>
            <p class="card-subtitle">灵活性高模式</p>
            <ul class="card-content">
              <li>用户购买单个课程或内容</li>
              <li>灵活性高，用户门槛低</li>
              <li>代表平台：知乎、喜马拉雅</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">广告模式</h4>
            <p class="card-subtitle">免费内容变现</p>
            <ul class="card-content">
              <li>免费内容+广告变现</li>
              <li>用户基数大，但单用户价值低</li>
              <li>代表平台：蜻蜓FM</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">混合模式</h4>
            <p class="card-subtitle">多元化收入</p>
            <ul class="card-content">
              <li>结合多种变现方式</li>
              <li>收入来源多元化，风险分散</li>
              <li>代表平台：小鹅通、千聊</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ==========================================
         页面 9：内容页 - 2.2 六大平台启示（第1部分）
         ========================================== -->
    <div class="slide">
      <h2 class="slide-title">2.2 六大平台启示 - 第1部分</h2>
      <div class="slide-content">
        <div class="highlight-cards">
          <div class="highlight-card">
            <h4 class="card-title">得到</h4>
            <p class="card-subtitle">知识服务</p>
            <ul class="card-content">
              <li>定位：精品知识服务平台</li>
              <li>核心：严选课程+音频书</li>
              <li>启示：内容质量>数量</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">喜马拉雅</h4>
            <p class="card-subtitle">音频内容</p>
            <ul class="card-content">
              <li>定位：综合音频平台</li>
              <li>核心：海量内容+UGC</li>
              <li>启示：内容丰富度很重要</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">知乎</h4>
            <p class="card-subtitle">社区问答</p>
            <ul class="card-content">
              <li>定位：知识问答社区</li>
              <li>核心：UGC+社区氛围</li>
              <li>启示：社区价值不可忽视</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">樊登读书</h4>
            <p class="card-subtitle">读书服务</p>
            <ul class="card-content">
              <li>定位：读书知识服务</li>
              <li>核心：书籍精华+社群</li>
              <li>启示：垂直领域深耕</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">混沌学园</h4>
            <p class="card-subtitle">商学教育</p>
            <ul class="card-content">
              <li>定位：创新商学教育</li>
              <li>核心：高端课程+线下活动</li>
              <li>启示：高客单价模式可行</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">蜻蜓FM</h4>
            <p class="card-subtitle">广播电台</p>
            <ul class="card-content">
              <li>定位：网络音频电台</li>
              <li>核心：版权内容+直播</li>
              <li>启示：版权内容是护城河</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ==========================================
         页面 10：内容页 - 2.2 六大平台启示（第2部分）
         ========================================== -->
    <div class="slide">
      <h2 class="slide-title">2.2 六大平台启示 - 第2部分</h2>
      <div class="slide-content">
        <div class="highlight-cards">
          <div class="highlight-card">
            <h4 class="card-title">小鹅通</h4>
            <p class="card-subtitle">工具平台</p>
            <ul class="card-content">
              <li>定位：知识付费技术服务商</li>
              <li>核心：SaaS工具+生态</li>
              <li>启示：赋能B端是新方向</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">荔枝微课</h4>
            <p class="card-subtitle">轻量课程</p>
            <ul class="card-content">
              <li>定位：轻量级课程平台</li>
              <li>核心：低价课程+快速传播</li>
              <li>启示：下沉市场有机会</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">千聊</h4>
            <p class="card-subtitle">直播课程</p>
            <ul class="card-content">
              <li>定位：直播课程平台</li>
              <li>核心：实时互动+社群</li>
              <li>启示：互动性提升转化</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">有书</h4>
            <p class="card-subtitle">阅读社群</p>
            <ul class="card-content">
              <li>定位：阅读社群平台</li>
              <li>核心：共读+社群运营</li>
              <li>启示：社群运营是关键</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ==========================================
         页面 11：内容页 - 3.1 战略建议
         ========================================== -->
    <div class="slide">
      <h2 class="slide-title">3.1 战略建议</h2>
      <div class="slide-content">
        <div class="highlight-cards">
          <div class="highlight-card">
            <h4 class="card-title">聚焦细分市场</h4>
            <ul class="card-content">
              <li>避免与头部平台正面竞争</li>
              <li>选择垂直细分领域深耕</li>
              <li>建立差异化竞争优势</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">打造内容护城河</h4>
            <ul class="card-content">
              <li>内容是核心竞争力</li>
              <li>投入资源生产优质内容</li>
              <li>建立内容生产机制</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">建立用户社群</h4>
            <ul class="card-content">
              <li>社群提升用户粘性</li>
              <li>通过社群运营增强用户归属感</li>
              <li>社群是口碑传播的基础</li>
            </ul>
          </div>
          <div class="highlight-card">
            <h4 class="card-title">优化变现模式</h4>
            <ul class="card-content">
              <li>探索多元化变现方式</li>
              <li>平衡用户体验与商业化</li>
              <li>提升单用户价值</li>
            </ul>
          </div>
        </div>
        
        <div class="emphasis-box" style="margin-top: 40px;">
          <h3>核心结论</h3>
          <p>强烈建议新平台聚焦细分市场，避免与头部平台直接竞争。内容质量是长期竞争力的核心，社群运营能够显著提升用户留存率。</p>
        </div>
      </div>
    </div>
    
    <!-- ==========================================
         页面 12：结束页
         ========================================== -->
    <div class="slide title-slide" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <h1 class="title-main" style="font-size: 48px;">Thank You</h1>
      <p class="subtitle">感谢观看</p>
      <p class="date-info" style="margin-top: 40px;">Questions?</p>
    </div>
    
  </div>
  <!-- End of Presentation Container -->
  
  <!-- Fullscreen Button -->
  <button class="fullscreen-btn" onclick="toggleFullscreen()">⛶</button>
```

**阶段3输出模板**：

✅ 阶段3/4完成：后半部分幻灯片已生成（页面7-12）

已生成内容：
✅ 页面 7：内容页 - 竞争格局（基于05-chart-text.html，95%匹配）
   - 使用图表+文本布局
   - 包含1个Chart.js柱状图（canvas ID: chartCompetition）
   - 包含4个关键洞察
   
✅ 页面 8：内容页 - 商业模式（基于04-card-grid.html，95%匹配）
   - 使用卡片网格布局（2x2）
   - 包含4种商业模式
   
✅ 页面 9：内容页 - 六大平台启示第1部分（基于04-card-grid.html，95%匹配）
   - 使用卡片网格布局（2x3）
   - 包含6个平台分析
   
✅ 页面 10：内容页 - 六大平台启示第2部分（基于04-card-grid.html，95%匹配）
   - 使用卡片网格布局（2x2）
   - 包含4个平台分析
   
✅ 页面 11：内容页 - 战略建议（基于04-card-grid.html，95%匹配）
   - 使用卡片网格布局（2x2）
   - 包含4个战略建议
   - 包含强调框（核心结论）
   
✅ 页面 12：结束页（基于01-cover-page.html修改）
   - 紫色渐变背景
   - Thank You标题

进度：90%完成

【请输入"继续"以生成JavaScript代码和结束标签】


**阶段4：生成JavaScript代码和结束标签**

**执行流程**：

✅ 阶段4/4：生成JavaScript代码和结束标签

生成内容：
1. <script> 标签开始
2. 导航逻辑（showSlide, nextSlide, previousSlide）
3. 键盘控制（方向键、空格键、ESC键）
4. 全屏切换功能
5. 所有图表初始化代码（Chart.js）
6. 事件监听器（DOMContentLoaded）
7. </script> 结束标签
8. </body> 结束标签
9. </html> 结束标签

**生成代码示例**：

```html
  <script>
    // ==========================================
    // 导航逻辑
    // ==========================================
    let currentSlide = 0;
    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;
    
    // 更新幻灯片计数器
    document.getElementById('totalSlides').textContent = totalSlides;
    
    /**
     * 显示指定索引的幻灯片
     * @param {number} n - 幻灯片索引
     */
    function showSlide(n) {
      // 边界检查
      if (n >= totalSlides) {
        currentSlide = totalSlides - 1;
      } else if (n < 0) {
        currentSlide = 0;
      } else {
        currentSlide = n;
      }
      
      // 隐藏所有幻灯片
      slides.forEach(slide => {
        slide.classList.remove('active');
      });
      
      // 显示当前幻灯片
      slides[currentSlide].classList.add('active');
      
      // 更新计数器
      document.getElementById('currentSlide').textContent = currentSlide + 1;
      
      // 更新按钮状态
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      
      if (currentSlide === 0) {
        prevBtn.disabled = true;
      } else {
        prevBtn.disabled = false;
      }
      
      if (currentSlide === totalSlides - 1) {
        nextBtn.disabled = true;
      } else {
        nextBtn.disabled = false;
      }
      
      // 滚动到顶部
      window.scrollTo(0, 0);
    }
    
    /**
     * 下一页
     */
    function nextSlide() {
      showSlide(currentSlide + 1);
    }
    
    /**
     * 上一页
     */
    function previousSlide() {
      showSlide(currentSlide - 1);
    }
    
    // ==========================================
    // 键盘控制
    // ==========================================
    document.addEventListener('keydown', function(e) {
      // 右箭头或空格键：下一页
      if (e.key === 'ArrowRight' || e.key === ' ') {
        e.preventDefault();
        nextSlide();
      }
      // 左箭头：上一页
      else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        previousSlide();
      }
      // ESC键：退出全屏
      else if (e.key === 'Escape') {
        if (document.fullscreenElement) {
          document.exitFullscreen();
        }
      }
    });
    
    // ==========================================
    // 全屏切换
    // ==========================================
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.error('无法进入全屏模式:', err);
        });
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }
    
    // ==========================================
    // 图表初始化
    // ==========================================
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化显示第一页
      showSlide(0);
      
      // ----------------------------------------
      // 图表1：竞争格局对比柱状图（页面7）
      // ----------------------------------------
      try {
        const ctx1 = document.getElementById('chartCompetition');
        if (ctx1) {
          new Chart(ctx1.getContext('2d'), {
            type: 'bar',
            data: {
              labels: ['平台A', '平台B'],
              datasets: [{
                label: '估值（美元）',
                data: [180000000, 1750000], // 18亿 vs 175万（取中值）
                backgroundColor: ['#F85d42', '#556EE6'],
                borderWidth: 0
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                },
                title: {
                  display: true,
                  text: '头部平台vs中小平台估值对比',
                  font: {
                    size: 18,
                    weight: 'bold'
                  },
                  color: '#000000',
                  padding: {
                    bottom: 20
                  }
                },
                tooltip: {
                  backgroundColor: 'rgba(0, 0, 0, 0.8)',
                  padding: 12,
                  titleFont: {
                    size: 14
                  },
                  bodyFont: {
                    size: 13
                  },
                  callbacks: {
                    label: function(context) {
                      let label = context.dataset.label || '';
                      if (label) {
                        label += ': ';
                      }
                      // 格式化为百万美元
                      const value = context.parsed.y;
                      if (value >= 1000000) {
                        label += '$' + (value / 1000000).toFixed(1) + 'M';
                      } else {
                        label += '$' + value.toLocaleString();
                      }
                      return label;
                    }
                  }
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function(value) {
                      // Y轴标签格式化
                      if (value >= 1000000) {
                        return '$' + (value / 1000000).toFixed(0) + 'M';
                      } else {
                        return '$' + (value / 1000).toFixed(0) + 'K';
                      }
                    },
                    font: {
                      size: 12
                    },
                    color: '#333333'
                  },
                  grid: {
                    color: '#e0e0e0',
                    drawBorder: false
                  }
                },
                x: {
                  ticks: {
                    font: {
                      size: 12
                    },
                    color: '#333333'
                  },
                  grid: {
                    display: false
                  }
                }
              }
            }
          });
        }
      } catch (error) {
        console.error('图表1初始化失败:', error);
      }
      
      // ----------------------------------------
      // 如果有更多图表，在这里添加初始化代码
      // ----------------------------------------
      
    });
    
    // ==========================================
    // 页面加载完成提示
    // ==========================================
    console.log('✅ McKinsey风格演示文稿加载完成');
    console.log('📊 总页数:', totalSlides);
    console.log('⌨️ 快捷键: 方向键/空格键翻页，ESC退出全屏');
  </script>
</body>
</html>
```

**阶段4输出模板**：

✅ 阶段4/4完成：JavaScript代码和结束标签已生成

已生成内容：
✅ <script> 标签开始
✅ 导航逻辑
   - showSlide(n) 函数：显示指定幻灯片
   - nextSlide() 函数：下一页
   - previousSlide() 函数：上一页
   - 幻灯片计数器更新
   - 按钮状态管理（禁用首页上一页、末页下一页）
   
✅ 键盘控制
   - 右箭头 / 空格键：下一页
   - 左箭头：上一页
   - ESC键：退出全屏
   
✅ 全屏切换
   - toggleFullscreen() 函数
   - 支持进入/退出全屏模式
   
✅ 图表初始化（DOMContentLoaded）
   - 图表1：竞争格局对比柱状图（chartCompetition）
     * 类型：bar（柱状图）
     * 数据：平台A（18亿美元）vs 平台B（175万美元）
     * 配色：橙色#F85d42 vs 蓝色#556EE6
     * 配置：responsive: true, maintainAspectRatio: false
     * Y轴格式化：百万美元（$XM）
     * Tooltip格式化：显示完整数值
   
✅ 事件监听器
   - DOMContentLoaded：初始化幻灯片和图表
   - keydown：键盘快捷键
   
✅ 结束标签
   - </script>
   - </body>
   - </html>

进度：100%完成

✅ HTML文件生成完成！

文件信息：
- 总页数：12页
- 总代码行数：约1200行
- CSS样式：约800行
- HTML内容：约300行
- JavaScript代码：约100行
- 图表数量：1个（Chart.js柱状图）
- 文件大小：约60KB

质量检查：
✅ HTML结构完整（DOCTYPE、head、body、结束标签）
✅ CSS样式完整（McKinsey配色、响应式设计）
✅ JavaScript功能完整（导航、键盘、全屏、图表）
✅ 所有幻灯片已生成（12页，100%内容）
✅ 图表配置正确（宽度100%、responsive、数据准确）
✅ 代码质量符合最佳实践（语义化、可访问性）

【文件已准备就绪，可以保存为 .html 文件】

---

##### 步骤 3.4：验证代码完整性与质量

**🎯 目标**：全面检查生成的HTML代码，确保内容完整、代码质量高、功能正常。

**执行要求**：

进行以下6项验证检查：
1. 内容完整性验证
2. 代码结构验证
3. CSS样式验证
4. JavaScript功能验证
5. 图表显示验证
6. 响应式设计验证

---

###### 验证1：内容完整性验证

**验证方法：对照步骤2的页面清单**

```markdown
内容完整性对照表：

步骤2页面清单              步骤3生成的HTML            状态
──────────────────────────────────────────────────
页面1：封面页              <div class="slide title-slide active">    ✓
页面2：目录页              <div class="slide">（toc-grid）           ✓
页面3：第一章章节首页      <div class="slide section-slide">         ✓
页面4：第二章章节首页      <div class="slide section-slide">         ✓
页面5：第三章章节首页      <div class="slide section-slide">         ✓
页面6：内容页-行业现状     <div class="slide">（three-column）       ✓
页面7：内容页-竞争格局     <div class="slide">（chart-text）         ✓
页面8：内容页-商业模式     <div class="slide">（card-grid）          ✓
页面9：内容页-六大平台1    <div class="slide">（card-grid）          ✓
页面10：内容页-六大平台2   <div class="slide">（card-grid）          ✓
页面11：内容页-战略建议    <div class="slide">（card-grid）          ✓
页面12：结束页             <div class="slide title-slide">           ✓
──────────────────────────────────────────────────
总计：12页                 总计：12页                                ✓

验证结果：✅ 页面数量完全匹配，所有页面已生成
```

**验证方法：对照步骤2的内容要点**

```markdown
内容要点对照表（抽样检查）：

页面6：行业现状（步骤2列出3个要点）
步骤2内容                              步骤3 HTML内容                    状态
────────────────────────────────────────────────────────────────
1. 市场规模达到500亿                   "500亿元" + 完整描述              ✓
2. 用户增长率15%                       "15%" + 完整描述                  ✓
3. 头部平台占据65%份额                 "65%" + 完整描述                  ✓

页面7：竞争格局（步骤2列出4个要点 + 图表）
步骤2内容                              步骤3 HTML内容                    状态
────────────────────────────────────────────────────────────────
1. 平台A估值14-21亿美元                "14-21亿美元" + 完整描述          ✓
2. 平台B估值150-200万美元              "150-200万美元" + 完整描述        ✓
3. 估值差距10-20倍                     "10-20倍" + 完整描述              ✓
4. 内容质量是关键                      "内容质量是核心竞争力" + 描述    ✓
图表：估值对比                         <canvas id="chartCompetition">    ✓

页面11：战略建议（步骤2列出4个要点）
步骤2内容                              步骤3 HTML内容                    状态
────────────────────────────────────────────────────────────────
1. 聚焦细分市场                        完整的3点描述                     ✓
2. 打造内容护城河                      完整的3点描述                     ✓
3. 建立用户社群                        完整的3点描述                     ✓
4. 优化变现模式                        完整的3点描述                     ✓
核心结论                               <div class="emphasis-box">        ✓

验证结果：✅ 内容要点100%保留，无遗漏、无删减、无简化
```

---

###### 验证2：代码结构验证

**验证项目：HTML最佳实践**

```markdown
HTML结构检查清单：

□ DOCTYPE声明                          ✓ <!DOCTYPE html>
□ 语言属性                             ✓ <html lang="zh-CN">
□ 字符编码                             ✓ <meta charset="UTF-8">
□ 视口设置                             ✓ <meta name="viewport"...>
□ 标题标签                             ✓ <title>知识付费平台分析报告</title>
□ 外部依赖                             ✓ Chart.js CDN (v4.4.0)
□ CSS内联                              ✓ <style>...</style>（800行）
□ JavaScript内联                       ✓ <script>...</script>（100行）

语义化标签检查：

□ 导航栏                               ✓ <nav class="navbar">
□ 标题层级                             ✓ <h1>, <h2>, <h3>, <h4>
□ 列表                                 ✓ <ul>, <li>
□ 段落                                 ✓ <p>
□ 按钮                                 ✓ <button>
□ Canvas                               ✓ <canvas id="chartCompetition">

标签闭合检查：

□ 所有<div>已闭合                      ✓ 已验证（12个.slide容器）
□ 所有<ul>已闭合                       ✓ 已验证
□ <style>已闭合                        ✓ 已验证
□ <script>已闭合                       ✓ 已验证
□ <body>已闭合                         ✓ 已验证
□ <html>已闭合                         ✓ 已验证

ID唯一性检查：

□ currentSlide                         ✓ 唯一
□ totalSlides                          ✓ 唯一
□ prevBtn                              ✓ 唯一
□ nextBtn                              ✓ 唯一
□ chartCompetition                     ✓ 唯一（图表canvas）

验证结果：✅ HTML结构完整，符合最佳实践，所有标签正确闭合
```

---

###### 验证3：CSS样式验证

**验证项目：McKinsey设计系统遵循度**

```markdown
McKinsey配色方案检查：

CSS变量定义                            使用情况                          状态
────────────────────────────────────────────────────────────────
--color-bg: #FFFFFF                    body背景、卡片背景                ✓
--color-text-primary: #000000          标题颜色                          ✓
--color-text-secondary: #333333        正文颜色                          ✓
--color-accent-primary: #F85d42        强调色、按钮、边框                ✓
--color-accent-secondary: #74788d      辅助色                            ✓
--color-blue: #556EE6                  图表颜色                          ✓
--color-green: #34c38f                 成功提示（key-insights）          ✓

排版层次检查：

字体大小                               实际使用                          状态
────────────────────────────────────────────────────────────────
--font-size-title-main: 64px           .title-main封面标题               ✓
--font-size-title-section: 48px        .chapter-title章节标题            ✓
--font-size-title-slide: 42px          .slide-title页面标题              ✓
--font-size-subtitle: 36px             .subtitle副标题                   ✓
--font-size-body-primary: 20px         正文、列表                        ✓
--font-size-body-secondary: 16px       次要文本                          ✓

布局样式检查：

布局类型                               CSS类名                           状态
────────────────────────────────────────────────────────────────
L1 - 单列布局                          .title-slide, .section-slide      ✓
L3 - 三列布局                          .three-column-layout              ✓
L4 - 卡片网格布局                      .highlight-cards                  ✓
L5 - 图表+文本布局                     .chart-text-layout                ✓
L8 - 目录页布局                        .toc-grid                         ✓

关键CSS属性检查：

.chart-container                       值                                状态
────────────────────────────────────────────────────────────────
width                                  100% !important                   ✓
min-width                              300px !important                  ✓
max-width                              100% !important                   ✓
height                                 500px                             ✓
box-sizing                             border-box                        ✓

.chart-container canvas                值                                状态
────────────────────────────────────────────────────────────────
width                                  100% !important                   ✓
height                                 100% !important                   ✓
display                                block !important                  ✓

响应式断点检查：

@media (max-width: 1024px)             规则                              状态
────────────────────────────────────────────────────────────────
.three-column-layout                   grid-template-columns: 1fr        ✓
.chart-text-layout                     grid-template-columns: 1fr        ✓
.chart-container height                400px                             ✓

@media (max-width: 768px)              规则                              状态
────────────────────────────────────────────────────────────────
.title-main                            font-size: 36px                   ✓
.slide-title                           font-size: 32px                   ✓
.chart-container height                300px                             ✓

验证结果：✅ CSS样式完整，严格遵循McKinsey设计系统，响应式设计完备
```

---

###### 验证4：JavaScript功能验证

**验证项目：导航和交互功能**

```markdown
导航逻辑检查：

函数名                                 功能                              状态
────────────────────────────────────────────────────────────────
showSlide(n)                           显示指定幻灯片                    ✓
  - 边界检查                           n<0 或 n>=totalSlides             ✓
  - 移除active类                       所有.slide移除active              ✓
  - 添加active类                       当前.slide添加active              ✓
  - 更新计数器                         #currentSlide文本更新             ✓
  - 更新按钮状态                       首页禁用上一页，末页禁用下一页    ✓
  - 滚动到顶部                         window.scrollTo(0, 0)             ✓

nextSlide()                            下一页                            ✓
  - 调用showSlide                      showSlide(currentSlide + 1)       ✓

previousSlide()                        上一页                            ✓
  - 调用showSlide                      showSlide(currentSlide - 1)       ✓

键盘控制检查：

按键                                   功能                              状态
────────────────────────────────────────────────────────────────
ArrowRight                             下一页                            ✓
Space（空格键）                        下一页                            ✓
ArrowLeft                              上一页                            ✓
Escape                                 退出全屏                          ✓
  - 阻止默认行为                       e.preventDefault()                ✓

全屏功能检查：

函数名                                 功能                              状态
────────────────────────────────────────────────────────────────
toggleFullscreen()                     切换全屏                          ✓
  - 进入全屏                           requestFullscreen()               ✓
  - 退出全屏                           exitFullscreen()                  ✓
  - 错误处理                           catch(err)                        ✓

事件监听器检查：

事件类型                               处理函数                          状态
────────────────────────────────────────────────────────────────
DOMContentLoaded                       初始化幻灯片和图表                ✓
  - 调用showSlide(0)                   显示第一页                        ✓
  - 初始化图表                         Chart.js初始化                    ✓
keydown                                键盘快捷键                        ✓

验证结果：✅ JavaScript功能完整，导航逻辑正确，键盘控制正常，全屏功能可用
```

---

###### 验证5：图表显示验证

**验证项目：Chart.js图表配置**

```markdown
图表1：chartCompetition（竞争格局对比柱状图）

配置项                                 值                                状态
────────────────────────────────────────────────────────────────
canvas ID                              chartCompetition                  ✓
图表类型                               bar（柱状图）                     ✓
responsive                             true                              ✓
maintainAspectRatio                    false                             ✓

数据配置检查：

labels                                 ['平台A', '平台B']                ✓
datasets[0].label                      '估值（美元）'                    ✓
datasets[0].data                       [180000000, 1750000]              ✓
  - 平台A数据                          180000000（18亿，取中值）         ✓
  - 平台B数据                          1750000（175万，取中值）          ✓
datasets[0].backgroundColor            ['#F85d42', '#556EE6']            ✓
  - 颜色1                              #F85d42（McKinsey橙色）           ✓
  - 颜色2                              #556EE6（McKinsey蓝色）           ✓

插件配置检查：

plugins.legend.display                 false                             ✓
plugins.title.display                  true                              ✓
plugins.title.text                     '头部平台vs中小平台估值对比'      ✓
plugins.title.font.size                18                                ✓
plugins.title.font.weight              'bold'                            ✓
plugins.title.color                    '#000000'                         ✓
plugins.tooltip.backgroundColor        'rgba(0, 0, 0, 0.8)'              ✓
plugins.tooltip.callbacks.label        格式化为$XM                       ✓

坐标轴配置检查：

scales.y.beginAtZero                   true                              ✓
scales.y.ticks.callback                格式化为$XM或$XK                  ✓
scales.y.ticks.font.size               12                                ✓
scales.y.ticks.color                   '#333333'                         ✓
scales.y.grid.color                    '#e0e0e0'                         ✓
scales.y.grid.drawBorder               false                             ✓
scales.x.ticks.font.size               12                                ✓
scales.x.ticks.color                   '#333333'                         ✓
scales.x.grid.display                  false                             ✓

错误处理检查：

try-catch包裹                          ✓ 已包裹
canvas存在性检查                       if (ctx1) { ... }                 ✓
console.error                          错误信息输出                      ✓

图表容器CSS验证（再次确认）：

.chart-container width                 100% !important                   ✓
.chart-container min-width             300px !important                  ✓
.chart-container height                500px                             ✓
canvas width                           100% !important                   ✓
canvas height                          100% !important                   ✓

验证结果：✅ 图表配置正确，数据准确，颜色符合McKinsey规范，容器CSS确保正常显示
```

---

###### 验证6：响应式设计验证

**验证项目：不同屏幕尺寸适配**

```markdown
桌面端（>1024px）：

布局                                   表现                              状态
────────────────────────────────────────────────────────────────
.three-column-layout                   3列并排                           ✓
.chart-text-layout                     左右并排（1:1）                   ✓
.highlight-cards                       自适应列数（2-3列）               ✓
.toc-grid                              自适应列数（2-3列）               ✓
.chart-container height                500px                             ✓

平板端（768px-1024px）：

布局                                   表现                              状态
────────────────────────────────────────────────────────────────
.three-column-layout                   1列纵向                           ✓
.chart-text-layout                     1列纵向（图表在上）               ✓
.highlight-cards                       2列并排                           ✓
.chart-container height                400px                             ✓
.title-main                            保持64px                          ✓

手机端（<768px）：

布局                                   表现                              状态
────────────────────────────────────────────────────────────────
.three-column-layout                   1列纵向                           ✓
.chart-text-layout                     1列纵向                           ✓
.highlight-cards                       1列纵向                           ✓
.chart-container height                300px                             ✓
.title-main                            36px                              ✓
.slide-title                           32px                              ✓
.navbar h1                             18px                              ✓
.nav-btn                               padding: 10px 16px                ✓

可读性检查：

屏幕尺寸                               字体大小                          状态
────────────────────────────────────────────────────────────────
桌面端 - 主标题                        64px                              ✓
桌面端 - 正文                          20px                              ✓
平板端 - 主标题                        64px                              ✓
平板端 - 正文                          20px                              ✓
手机端 - 主标题                        36px                              ✓
手机端 - 正文                          20px                              ✓

验证结果：✅ 响应式设计完备，所有断点已配置，各屏幕尺寸下布局合理、可读性良好
```

---

##### 步骤3.4总结：验证报告

```markdown
✅ 步骤3.4：代码完整性与质量验证 - 100%通过

验证项目                               结果                              通过率
──────────────────────────────────────────────────────────────────
1. 内容完整性验证                      ✅ 12页全部生成，内容100%保留     100%
2. 代码结构验证                        ✅ HTML结构完整，符合最佳实践     100%
3. CSS样式验证                         ✅ 严格遵循McKinsey设计系统       100%
4. JavaScript功能验证                  ✅ 导航、键盘、全屏功能正常       100%
5. 图表显示验证                        ✅ Chart.js配置正确，数据准确     100%
6. 响应式设计验证                      ✅ 3个断点完备，布局自适应        100%
──────────────────────────────────────────────────────────────────
总体通过率                             ✅ 100%

详细检查结果：

✅ 页面数量：12页（与步骤2完全一致）
✅ 内容保留：100%（无遗漏、无删减、无简化）
✅ HTML标签：所有标签正确闭合
✅ CSS样式：800行，McKinsey配色，响应式设计
✅ JavaScript：100行，导航、键盘、全屏、图表
✅ 图表配置：1个Chart.js柱状图，配置正确
✅ 代码质量：符合HTML最佳实践
✅ 可访问性：语义化标签，ID唯一
✅ 性能优化：CSS/JS内联，减少HTTP请求
✅ 浏览器兼容：现代浏览器（Chrome、Safari、Firefox、Edge）

文件信息：
- 文件大小：约60KB
- 总代码行数：约1200行
- 加载时间：<1秒（本地）
- 依赖项：Chart.js CDN（唯一外部依赖）

建议的文件名：
知识付费平台分析报告_McKinsey风格演示文稿.html

【步骤3全部完成，HTML文件已准备就绪】
```

---

#### 📊 步骤3完整输出清单

**步骤3完成后，必须输出以下产物：**

1. **代码规划方案**（步骤3.2）
   - 每页的布局类型
   - 每页的示例模板匹配结果
   - 每页的CSS样式清单
   - 每页的HTML结构
   - 每页的JavaScript代码（如有图表）

2. **完整HTML文件**（步骤3.3）
   - 阶段1：HTML框架和CSS（约30%）
   - 阶段2：前半部分幻灯片（约60%）
   - 阶段3：后半部分幻灯片（约90%）
   - 阶段4：JavaScript和结束标签（100%）

3. **验证报告**（步骤3.4）
   - 内容完整性验证结果
   - 代码结构验证结果
   - CSS样式验证结果
   - JavaScript功能验证结果
   - 图表显示验证结果
   - 响应式设计验证结果

---

#### ⚠️ 步骤3关键提醒

1. **资源读取是第一步**
   - 必须先读取所有必读资源
   - 不可跳过任何资源
   - 资源过长时使用"继续"机制分批读取

2. **示例模板对比是核心**
   - 每页都必须选择匹配的示例模板
   - 计算匹配度（≥80%高度匹配）
   - 基于示例生成代码，不凭空设计

3. **分批生成保证质量**
   - 使用固定的4个阶段顺序
   - 每个阶段代码必须完整
   - 每个阶段结束后提示用户"继续"
   - 禁止压缩、省略、简化代码

4. **图表配置必须正确**
   - width: 100% !important
   - responsive: true
   - maintainAspectRatio: false
   - canvas ID唯一
   - 在DOMContentLoaded中初始化

5. **验证环节不可跳过**
   - 必须进行6项验证检查
   - 发现问题立即返回对应阶段修复
   - 验证通过才能交付

---

#### ✅ 步骤3验收标准

**以下所有标准必须100%通过：**

- [ ] 所有必读资源已读取（6个资源）
- [ ] 每页都有代码规划方案
- [ ] 每页都有匹配的示例模板（匹配度≥80%）
- [ ] HTML文件已完整生成（4个阶段）
- [ ] CSS样式完整（800行，McKinsey配色）
- [ ] JavaScript功能完整（导航、键盘、全屏、图表）
- [ ] 图表配置正确（宽度100%，数据准确）
- [ ] 响应式设计完备（3个断点）
- [ ] 所有HTML标签正确闭合
- [ ] 内容100%保留（与步骤2一致）
- [ ] 6项验证检查全部通过
- [ ] 验证报告显示"100%通过"

**如果任何一项未通过，必须返回对应子步骤重新执行！**

---

**步骤3完成后，输出：**

```
✅ 步骤3：HTML样式布局代码规划与生成 - 100%完成

输出摘要：
- 资源读取：6个必读资源100%读取完成
- 代码规划：12页全部规划完成
- 示例匹配：平均匹配度92%（85%-100%）
- HTML生成：1200行代码，4个阶段100%完成
- 图表数量：1个Chart.js柱状图
- 验证结果：6项验证100%通过
- 文件大小：约60KB
- 质量评分：A+（完全符合McKinsey标准）

已进入步骤4：代码内容审核检验
```

---


### 步骤 4️⃣：代码内容审核检验

**⚠️ 最关键步骤！必须严格执行！**

**目标**：全面检查生成的 HTML 演示文稿，确保质量和完整性。

**执行要求**：

#### 5.1 🔍 资源使用验证（必须100%通过）

**⚠️ 验证步骤2和步骤3是否正确读取并使用了skill资源**

**步骤2资源使用验证：**

**验证方法1：检查图表选择是否基于chart-selection-guide.md**
```
□ 是否读取了 chart-selection-guide.md？
□ 是否识别了内容结构类型（9种类型之一）？
□ 是否根据决策树选择了对应的图表？
□ 是否记录了选择理由（关键词匹配）？

如果否 → 返回步骤2重新执行
```

**验证方法2：检查是否参考了图表示例文件**
```
□ 是否读取了 CHART_EXAMPLES_INDEX.md？
□ 每个选择的图表是否都有对应的示例文件？
□ 是否从示例文件中复制了代码？
□ 图表类型与内容是否匹配？

如果否 → 返回步骤2重新执行
```

**验证方法3：检查是否阅读了观点可视化指南**
```
□ 是否读取了 INSIGHT_VISUALIZATION_GUIDE.md？
□ 是否根据观点类型选择了可视化方式？
□ 是否避免了纯文本项目符号列表？

如果否 → 返回步骤2重新执行
```

**步骤3资源使用验证：**

**验证方法1：检查是否基于最佳实践生成**
```
□ 是否读取了 best-practices.md？
□ HTML结构是否符合语义化要求？
□ CSS是否遵循了设计原则？
□ 是否保持了内容完整性（不总结、不篡改）？

如果否 → 返回步骤3重新执行
```

**验证方法2：检查是否遵循了McKinsey设计系统**
```
□ 是否读取了 mckinsey-design-system.md？
□ 是否使用了定义的配色方案？
□ 字体大小是否符合规范？
□ 间距是否符合标准？

如果否 → 返回步骤3重新执行
```

**验证方法3：检查是否使用了模板**
```
□ 是否读取了 presentation-template.html？
□ HTML结构是否基于模板？
□ 导航功能是否完整？
□ 是否包含了模板中的所有必要组件？

如果否 → 返回步骤3重新执行
```

**验证方法4：检查图表代码来源**
```
□ 每个图表的代码是否来自assets/示例文件？
□ 是否完整复制了CSS、HTML、JavaScript？
□ 是否根据实际数据进行了定制？
□ McKinsey配色是否保持一致？

如果否 → 返回步骤3重新执行
```

**资源使用检查清单：**
```
步骤2 - 幻灯片设计阶段：
□ 已读取：references/chart-selection-guide.md
□ 已读取：assets/CHART_EXAMPLES_INDEX.md
□ 已读取：assets/INSIGHT_VISUALIZATION_GUIDE.md
□ 已制作：图表选择决策表（内容类型 → 关键词 → 推荐图表 → 示例文件）
□ 已记录：每个图表的选择理由
□ 已复制：对应示例文件的代码

步骤3 - HTML生成阶段：
□ 已读取：references/best-practices.md
□ 已读取：references/mckinsey-design-system.md
□ 已读取：references/template-guide.md
□ 已读取：assets/presentation-template.html
□ 已读取：assets/TEMPLATE_USAGE_GUIDE.md
□ 已复制：所有选中图表的示例代码
□ 已应用：McKinsey配色和排版规范
□ 已保持：内容完整性（零篡改、零遗漏）

❌ 发现任何资源未读取或未使用 → 立即返回对应步骤重新执行
```

**⚠️ 回退触发条件：**
```
以下任一情况发生，必须回退：

1. 步骤2未读chart-selection-guide.md
   → 返回步骤2，读取资源后重新选择图表

2. 步骤2选择的图表与chart-selection-guide.md不符
   → 返回步骤2，根据指南重新选择

3. 步骤2未从assets/示例文件复制代码
   → 返回步骤2，读取示例文件后复制代码

4. 步骤3未读best-practices.md
   → 返回步骤3，读取资源后重新生成HTML

5. 步骤3生成的HTML不符合mckinsey-design-system.md规范
   → 返回步骤3，根据规范重新生成

6. 步骤3未基于presentation-template.html
   → 返回步骤3，使用模板重新生成
```


#### 5.1.5 🔍 Token限制处理验证（新增）

**⚠️ 验证是否正确处理了 token 限制问题**

**检查AI是否因为 token 限制而偷工减料：**

**验证项目1：是否使用了"继续"机制**
```
□ 是否在任何阶段使用了"继续"分批处理？
□ 是否明确说明了进度百分比？
□ 是否提示用户输入"继续"？
□ 分批处理后是否最终完成了100%的内容？

如果否 → 可能存在偷工减料，需要检查：
- 是否跳过了某些资源读取？
- 是否省略了某些内容生成？
- 是否使用了简化版而非完整版？
```

**验证项目2：资源读取是否完整**
```
□ 步骤2读取的3个资源是否完整读取？
□ 步骤3读取的5个资源是否完整读取？
□ 如果资源文件很长，是否分批读取？
□ 是否有"请输入'继续'以读取剩余内容"的提示？

如果否 → 说明AI为了省token而跳过了资源
→ 返回步骤2或步骤3重新执行
```

**验证项目3：内容生成是否完整**
```
□ 是否所有章节都已生成？
□ 是否所有图表都已生成？
□ 是否所有数据都已包含？
□ HTML文件是否是完整的（标签闭合）？
□ JavaScript是否完整（无语法错误）？

如果否 → 说明AI为了省token而压缩了内容
→ 返回步骤3重新生成完整内容
```

**Token限制处理的验收标准：**

✅ **合格标准：**
- 遇到 token 限制时，明确说明并使用"继续"机制
- 分批处理但最终100%完成所有内容
- 所有资源都已完整读取（可能分批）
- 最终生成的HTML文件完整可用
- 没有因为 token 限制而丢失任何内容

❌ **不合格标准（需要回退）：**
- 为了省 token 而跳过资源读取
- 为了省 token 而简化内容
- 为了省 token 而使用摘要代替完整代码
- 分批生成但最终内容不完整
- 没有提示用户"继续"导致任务中止

**正确的"继续"机制示例：**
```
✅ 阶段1完成：已读取资源前半部分
【请输入"继续"以读取剩余部分】

用户输入："继续"

✅ 阶段2完成：资源100%读取完成
【已进入下一步骤】
```

#### 5.1.6 🔍 图表显示和布局优化验证（⚠️ 新增）

**⚠️ 验证图表是否正常显示，布局是否充分利用横向空间**

**检查AI是否正确处理了图表显示和布局优化：**

**验证项目1：图表容器CSS是否正确**
```
□ .chart-container是否包含width: 100% !important？
□ .chart-container是否包含min-width: 300px !important？
□ .chart-container是否包含max-width: 100% !important？
□ canvas元素是否包含width: 100% !important？
□ canvas元素是否包含height: 100% !important？
□ .chart-container是否包含box-sizing: border-box？

如果否 → 图表宽度可能为0，返回步骤3修复CSS
```

**验证项目2：Chart.js配置是否正确**
```
□ 所有图表是否设置了responsive: true？
□ 所有图表是否设置了maintainAspectRatio: false？
□ 图表是否有合理的height（400-500px）？
□ 图表是否在DOMContentLoaded之后初始化？
□ 每个图表的canvas ID是否唯一？
□ 每个图表的变量名是否唯一？

如果否 → 图表无法正常显示，返回步骤3修复配置
```

**验证项目3：布局是否充分利用横向空间**
```
□ 是否优先使用横向布局（双列、三列、网格）？
□ 是否避免纵向长列表导致需要滚动？
□ 单屏内容是否不超过视口高度的80%？
□ 4-6个观点是否使用卡片网格布局？
□ 2-3个观点是否使用双列或三列布局？

如果否 → 布局不够优化，返回步骤2或3优化布局
```

**验证项目4：随机选择机制是否正确应用**
```
□ 当有多种可选布局时，是否使用了随机选择？
□ 布局选择是否有足够的多样性（避免单调）？
□ 布局类型是否与内容结构匹配？

如果否 → 布局过于单一，返回步骤2优化选择逻辑
```

**验证项目5：图表实际显示效果**
```
□ 打开HTML文件，检查所有图表是否可见？
□ 检查图表宽度是否为正常值（非0）？
□ 检查图表高度是否合理（400-500px）？
□ 检查图表数据是否正确显示？
□ 检查图表交互是否正常（悬停、点击）？

如果否 → 图表显示有问题，返回步骤3修复
```

**图表显示问题诊断流程：**

```
问题1：图表宽度为0
├─ 检查：.chart-container { width: 100% !important; }
├─ 检查：canvas { width: 100% !important; }
├─ 检查：Chart.js配置 responsive: true
└─ 解决方案：添加上述CSS和配置

问题2：图表显示过小
├─ 检查：.chart-container { height: 500px; }
├─ 检查：Chart.js配置 maintainAspectRatio: false
└─ 解决方案：调整高度和配置

问题3：多个图表只有部分显示
├─ 检查：每个canvas ID唯一性
├─ 检查：DOMContentLoaded中初始化
└─ 解决方案：修复ID和初始化逻辑

问题4：纵向长列表需要滚动
├─ 检查：观点数量
├─ 如果4-6个 → 使用卡片网格布局
├─ 如果7+个 → 分页或分组展示
└─ 解决方案：返回步骤2优化布局选择

问题5：布局过于单调
├─ 检查：是否使用了多种布局类型
├─ 解决方案：应用随机选择机制
└─ 解决方案：增加布局多样性
```

**图表显示和布局的验收标准：**

✅ **合格标准：**
- 所有图表都正常显示（宽度非0）
- 图表大小合理（高度400-500px）
- 布局充分利用横向空间
- 避免纵向长列表导致滚动
- 4-6个观点使用卡片网格布局
- 布局有足够的多样性

❌ **不合格标准（需要回退）：**
- 图表宽度为0或过小
- 图表配置不正确
- 纵向长列表导致需要滚动
- 布局过于单一（所有页面都用单列）
- 多个观点未使用网格布局
- 未充分利用横向空间

**回退触发条件：**

```
以下任一情况发生，必须回退：

1. 发现图表宽度为0
   → 返回步骤3，添加修复CSS

2. 发现图表配置不正确
   → 返回步骤3，修复Chart.js配置

3. 发现纵向长列表需要滚动
   → 返回步骤2或3，优化布局

4. 发现布局过于单一
   → 返回步骤2，应用随机选择机制

5. 发现多个观点未使用网格布局
   → 返回步骤2或3，改用卡片网格
```

**正确的图表和布局示例：**

```
✅ 正确示例1：图表容器CSS
.chart-container {
  width: 100% !important;
  min-width: 300px !important;
  max-width: 100% !important;
  height: 500px;
  box-sizing: border-box;
}

✅ 正确示例2：Chart.js配置
{
  responsive: true,
  maintainAspectRatio: false,
  // ... 其他配置
}

✅ 正确示例3：卡片网格布局（4-6个观点）
<div class="highlight-cards">
  <div class="highlight-card">...</div>
  <div class="highlight-card">...</div>
  <div class="highlight-card">...</div>
  <div class="highlight-card">...</div>
</div>

✅ 正确示例4：三列布局（3个观点）
<div class="three-column-layout">
  <div class="column">...</div>
  <div class="column">...</div>
  <div class="column">...</div>
</div>

❌ 错误示例1：单列长列表（7+个观点）
<div class="slide">
  <ul class="bullet-list">
    <li>观点1</li>
    <li>观点2</li>
    <!-- ... 7+个观点，需要滚动 -->
  </ul>
</div>

❌ 错误示例2：缺少width: 100%
.chart-container {
  /* 缺少width: 100% */
  height: 500px;
}
```

---

#### 5.1.7 🔍 布局合理性验证（⚠️ 新增）

**⚠️ 验证是否在步骤2.0中先确定布局，再选择图表/图文**

**检查AI是否按照正确的顺序进行布局和图表选择：**

**验证项目1：布局选择是否在图表选择之前**
```
□ 是否在步骤2.0中先确定了页面布局？
□ 是否基于内容特征（观点数量、数据密度）选择布局？
□ 是否记录了每页幻灯片的布局类型？
□ 是否在确定布局后才进入步骤2.1选择图表？

如果否 → 说明顺序错误，返回步骤2重新执行
```

**验证项目2：布局类型选择是否合理**
```
□ 1个观点是否使用单列布局？
□ 2-3个观点是否使用双列或三列布局？
□ 4-6个观点是否使用卡片网格布局？
□ 7+个观点是否分页或使用混合布局？
□ 包含图表的页面是否使用图表+文本布局？

如果否 → 说明布局选择不合理，返回步骤2.0重新选择
```

**验证项目3：布局与内容的匹配度**
```
□ 对比内容是否使用双列或对比表格？
□ 并列内容是否使用三列或卡片网格？
□ 数据密集内容是否使用图表+文本布局？
□ 单个核心观点是否使用单列或强调框？

如果否 → 说明布局与内容不匹配，返回步骤2.0重新选择
```

**验证项目4：布局空间利用率**
```
□ 是否充分利用横向空间（避免左右空白）？
□ 是否避免纵向长列表导致需要滚动？
□ 单屏内容是否不超过视口高度的80%？
□ 图表容器宽度是否为100%？

如果否 → 说明空间利用率不足，返回步骤2.0或3优化
```

**验证项目5：布局多样性**
```
□ 20页幻灯片是否至少使用了3种不同布局？
□ 是否避免所有页面都使用相同布局？
□ 布局选择是否有足够的视觉变化？

如果否 → 说明布局过于单一，返回步骤2.0增加多样性
```

**布局合理性验收标准：**

✅ **合格标准：**
- 在步骤2.0中先确定布局，再选择图表
- 布局类型与内容特征匹配
- 充分利用横向空间，避免纵向滚动
- 布局有足够的多样性（至少3种）
- 图表+文本布局正确配置

❌ **不合格标准（需要回退）：**
- 先选择图表再确定布局（顺序错误）
- 7+个观点使用单列布局（空间浪费）
- 所有页面使用相同布局（过于单调）
- 布局与内容类型不匹配（对比用单列）
- 图表宽度为0或过小（配置错误）

**回退触发条件：**

```
以下任一情况发生，必须回退：

1. 发现布局选择在图表选择之后
   → 返回步骤2，先执行2.0布局规划，再执行2.1图表选择

2. 发现7+个观点使用单列布局
   → 返回步骤2.0，改用卡片网格或混合布局

3. 发现所有页面都使用相同布局
   → 返回步骤2.0，增加布局多样性

4. 发现布局与内容类型不匹配
   → 返回步骤2.0，重新选择布局类型

5. 发现横向空间大量空白
   → 返回步骤2.0或3，优化为多列布局
```

**正确的布局选择流程示例：**

```
✅ 正确示例：步骤2.0 → 步骤2.1

步骤2.0（布局规划）：
页面16：六大平台启示
├─ 内容特征：6个并列要点，无数据
├─ 观点数量：6个
├─ 数据密度：低
└─ 确定布局：卡片网格布局（L4）

步骤2.1（图表选择）：
页面16：六大平台启示
├─ 左列区域（卡片1-3）：商业模式、用户定位、定价策略
├─ 右列区域（卡片4-6）：内容策略、增长策略、风险规避
└─ 选择呈现方式：highlight-card + bullet-list

结果：充分利用横向空间，6个要点横向排列，无需滚动
```

```
❌ 错误示例：直接选择图表，忽略布局规划

错误做法：
页面16：六大平台启示
├─ ❌ 直接选择：bullet-list（单列布局）
├─ ❌ 结果：6个要点纵向排列，需要上下滚动
└─ ❌ 问题：横向空间大量浪费，用户体验差

正确做法：
├─ ✅ 先确定布局：卡片网格布局（步骤2.0）
├─ ✅ 再选择呈现：highlight-card（步骤2.1）
└─ ✅ 结果：横向排列，无需滚动，空间充分利用
```

**布局决策检查清单：**

在生成HTML之前，必须完成以下检查：

```
□ 已为每页幻灯片确定布局类型（L1-L12）
□ 已记录每页选择的布局理由
□ 已验证布局与内容特征匹配
□ 已验证布局空间利用率
□ 已验证布局多样性
□ 确认布局在图表选择之前确定
```

**如果任何一项为"否"，不得进入步骤3，必须返回步骤2重新规划布局。**

---

#### 5.2 🔍 内容完整性检查（必须100%通过）

**⚠️ 严格检验方法 - 逐章对照原文档：**

**第一步：提取原文档的所有章节结构**
```
使用工具提取文档的所有标题
推荐使用 Read 工具完整阅读文档，记录所有标题层级
```

**第二步：制作章节对照清单**
创建一个对照表，逐项检查：
```
原文档章节                    幻灯片页码    是否完整    备注
────────────────────────────────────────────────────
章节1：标题                    第X页         □ 是 □ 否
  - 子章节1.1                  第Y页         □ 是 □ 否
  - 子章节1.2                  第Z页         □ 是 □ 否
章节2：标题                    第A页         □ 是 □ 否
...
```

**第三步：逐项内容验证**

**✅ 必须验证的内容类型：**
- [ ] **所有一级标题（#）**：必须全部呈现为独立章节封面页
- [ ] **所有二级标题（##）**：必须全部呈现为幻灯片页面标题或独立页面
- [ ] **所有三级标题（###）**：必须全部包含在对应页面中
- [ ] **所有数据表格**：必须完整转换为HTML表格或图表
- [ ] **所有数值数据**：
  - 金额（如：14-21亿、150-200万）
  - 百分比（如：15%、65%）
  - 数量（如：50万用户、6000万）
  - 对比值（如：10-20倍差距）
- [ ] **所有结论性陈述**：
  - "强烈建议"类结论
  - "关键"类要点
  - "优势/劣势"分析
  - "成功案例"列举
- [ ] **所有建议和行动计划**：
  - 时间线（如：3年目标、5年目标）
  - 行动步骤
  - 实操建议
- [ ] **所有对比分析**：
  - A vs B 对比表
  - 优缺点对比
  - 差异分析

**❌ 发现内容缺失时的处理：**

**立即停止！执行回退流程：**

1. **记录缺失内容**
```
缺失内容清单：
1. 缺失章节：《XXX章节》
   - 缺失原因：[分析原因]
   - 应包含内容：[列出缺失的具体内容]
2. 缺失数据：XXX数值
3. 缺失结论：XXX结论
```

2. **返回步骤1（文档内容分析）**
```
⚠️ 检验未通过！返回步骤1重新分析文档

问题原因：
[例如：步骤1中未提取"商业模式"章节的标题结构]

重新执行：
- 重新完整阅读文档
- 补充提取缺失的章节内容
- 更新内容结构大纲
- 验证无遗漏后再进入步骤2
```

3. **返回步骤2（幻灯片设计）**
```
⚠️ 检验未通过！返回步骤2重新设计

问题原因：
[例如：步骤2中页面规划遗漏了"商业模式"章节]

重新执行：
- 补充缺失章节的页面规划
- 更新幻灯片页面规划表
- 为缺失内容选择合适的呈现形式
- 验证规划完整性后再进入步骤3
```

4. **返回步骤3（HTML生成）**
```
⚠️ 检验未通过！返回步骤3重新生成

问题原因：
[例如：步骤3中生成HTML时遗漏了部分内容]

重新执行：
- 补充生成缺失内容的幻灯片
- 确保所有规划的内容都已生成
- 验证内容完整性后再进入步骤4
```

#### 5.4 设计规范检查

**McKinsey 风格验证**：
- [ ] 配色方案严格遵循规范
- [ ] 排版层次清晰一致
- [ ] 字体大小符合规范
- [ ] 间距和留白适当
- [ ] 页面布局整洁专业

**视觉质量评估**：
- [ ] 图表清晰易读
- [ ] 文字对比度充足
- [ ] 视觉层次分明
- [ ] 无杂乱或拥挤感
- [ ] 整体风格统一

#### 5.5 功能性测试

**导航功能**：
- [ ] "上一页"按钮正常工作
- [ ] "下一页"按钮正常工作
- [ ] 键盘方向键控制正常
- [ ] 空格键翻页正常
- [ ] 幻灯片计数器准确
- [ ] 页面切换流畅

**交互功能**：
- [ ] 全屏模式正常
- [ ] ESC退出全屏正常
- [ ] 图表悬停提示显示
- [ ] 图表交互响应灵敏

**响应式设计**：
- [ ] 桌面端显示正常
- [ ] 平板端显示正常
- [ ] 移动端显示正常
- [ ] 不同屏幕尺寸自适应

#### 5.6 兼容性测试

**浏览器兼容性**：
- [ ] Chrome 浏览器正常显示
- [ ] Safari 浏览器正常显示
- [ ] Firefox 浏览器正常显示
- [ ] Edge 浏览器正常显示

**性能检查**：
- [ ] 页面加载速度合理（< 3秒）
- [ ] 幻灯片切换流畅无卡顿
- [ ] 图表渲染无延迟
- [ ] 无 JavaScript 错误

#### 5.7 ✅ 代码质量检查（严格遵循HTML最佳实践）

**⚠️ 必须验证的HTML最佳实践：**

**A. HTML结构与可访问性**
- [ ] **DOCTYPE声明**：必须包含 `<!DOCTYPE html>`
- [ ] **语言属性**：`<html lang="zh-CN">` 正确设置
- [ ] **字符编码**：`<meta charset="UTF-8">` 必须在head中
- [ ] **视口设置**：`<meta name="viewport" content="width=device-width, initial-scale=1.0">`
- [ ] **语义化标签**：
  - 使用 `<nav>` 而非 `<div class="nav">`
  - 使用 `<section>` 或 `<article>` 包含内容块
  - 使用 `<h1>-<h6>` 而非样式化标题
  - 使用 `<button>` 而非 `<div onclick="...">`
  - 表格使用 `<thead>`, `<tbody>`, `<th>`, `<td>`
- [ ] **图片替代文本**：所有 `<img>` 必须有 `alt` 属性
- [ ] **表单标签**：输入框必须有对应的 `<label>`

**B. CSS最佳实践**
- [ ] **响应式设计**：
  - 使用媒体查询 `@media (max-width: ...)`
  - 使用相对单位（rem, em, %）而非固定px
  - 移动端优先设计
- [ ] **性能优化**：
  - 避免过度嵌套选择器（最多3层）
  - 使用类选择器而非标签选择器
  - 避免使用 `!important`
  - 合并重复样式
- [ ] **可维护性**：
  - 使用CSS变量（`:root`）定义颜色和尺寸
  - BEM命名规范或一致的命名约定
  - 注释说明复杂样式

**C. JavaScript最佳实践**
- [ ] **错误处理**：
  ```javascript
  // 必须包含错误处理
  try {
      // 图表初始化代码
  } catch (error) {
      console.error('图表初始化失败:', error);
      // 向用户显示友好提示
  }
  ```
- [ ] **DOM操作**：
  - 等待DOM加载完成：`document.addEventListener('DOMContentLoaded', ...)`
  - 缓存DOM查询：`const slides = document.querySelectorAll('.slide')`
  - 事件委托（如适用）
- [ ] **性能优化**：
  - 避免在循环中操作DOM
  - 使用 `requestAnimationFrame` 进行动画
  - 防抖/节流事件处理（如resize, scroll）
- [ ] **内存泄漏检查**：
  - 移除事件监听器（如需要）
  - 清空定时器和间隔器
  - 避免闭包中的循环引用

**D. 外部依赖**
- [ ] **CDN链接**：
  - 使用可靠的CDN（如 jsdelivr, unpkg）
  - 指定版本号（如 `@4.4.0`）而非 `@latest`
  - 检查CDN可访问性
- [ ] **备用方案**：
  ```html
  <!-- 如果CDN失败，提供备用方案 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script>
      if (typeof Chart === 'undefined') {
          document.body.innerHTML = '<div style="padding:40px;text-align:center;">无法加载图表库，请检查网络连接</div>';
      }
  </script>
  ```

**E. 浏览器兼容性**
- [ ] **前缀处理**：使用 `autoprefixer` 或手动添加浏览器前缀
- [ ] **降级方案**：为不支持的浏览器提供基本功能
- [ ] **特性检测**：使用 `Modernizr` 或手动检测

**❌ 代码质量未通过时的处理：**

**立即执行修复流程：**

1. **记录问题清单**
```
代码质量问题清单：
1. HTML问题：
   - [ ] 缺少DOCTYPE声明
   - [ ] 未使用语义化标签
   - [ ] 缺少viewport设置
2. CSS问题：
   - [ ] 无响应式设计
   - [ ] 使用!important过多
3. JavaScript问题：
   - [ ] 无错误处理
   - [ ] DOM加载前执行
4. 兼容性问题：
   - [ ] CDN不可访问
   - [ ] 特定浏览器不支持
```

2. **返回步骤3（HTML生成）**
```
⚠️ 代码质量检验未通过！返回步骤3重新生成

问题原因：
[列出具体的代码质量问题]

重新执行：
- 修复所有HTML结构问题
- 添加必要的meta标签和语义化标签
- 优化CSS性能和可维护性
- 完善JavaScript错误处理
- 测试浏览器兼容性
- 验证所有最佳实践后再进入步骤4
```

3. **常见问题修复模板**

**修复示例1：添加错误处理**
```javascript
// ❌ 错误写法
const ctx = document.getElementById('myChart');
new Chart(ctx, { ... });

// ✅ 正确写法
try {
    const ctx = document.getElementById('myChart');
    if (!ctx) {
        throw new Error('无法找到图表容器');
    }
    new Chart(ctx, { ... });
} catch (error) {
    console.error('图表初始化失败:', error);
    // 显示友好错误提示
}
```

**修复示例2：DOM加载检查**
```javascript
// ❌ 错误写法
const slides = document.querySelectorAll('.slide');
showSlide(0);

// ✅ 正确写法
document.addEventListener('DOMContentLoaded', () => {
    const slides = document.querySelectorAll('.slide');
    if (slides.length === 0) {
        console.error('未找到任何幻灯片');
        return;
    }
    showSlide(0);
});
```

**修复示例3：响应式设计**
```css
/* ❌ 错误写法 */
.slide-content {
    width: 1400px;
    padding: 60px;
}

/* ✅ 正确写法 */
.slide-content {
    max-width: 1400px;
    width: 100%;
    padding: 60px;
}

@media (max-width: 1024px) {
    .slide-content {
        padding: 30px;
    }
}
```

#### 5.8 🎯 最终验收标准（一票否决制）

**⚠️ 以下任一标准未通过，即为不合格，必须回退重新执行！**

**✅ 标准一：内容完整性（核心标准，一票否决）**

**检验方法：逐章对照原文档**
```
必须100%满足：
□ 所有章节标题已呈现
□ 所有子章节已包含
□ 所有数据点已保留
□ 所有结论已呈现
□ 所有建议已包含
□ 所有表格已转换
□ 所有对比分析已呈现

✓ 零遗漏原则：任何内容缺失，即为不合格
✓ 零篡改原则：任何内容曲解，即为不合格
✓ 准确性原则：任何数据错误，即为不合格
```

**❌ 发现任何内容问题 → 立即返回步骤1重新分析**

**✅ 标准二：代码质量（核心标准，一票否决）**

**检验方法：HTML最佳实践检查清单**
```
必须100%满足：
□ DOCTYPE声明正确
□ 语言和字符编码设置
□ 视口和响应式设计
□ 语义化HTML标签
□ JavaScript错误处理
□ DOM加载检查
□ CDN可访问性
□ 浏览器兼容性

✓ 可访问性原则：不符合WCAG标准，即为不合格
✓ 性能原则：加载过慢或有错误，即为不合格
✓ 兼容性原则：主流浏览器无法访问，即为不合格
```

**❌ 发现任何代码问题 → 立即返回步骤3重新生成**

**✅ 标准三：设计规范（重要标准）**
- [ ] McKinsey配色方案严格遵循
- [ ] 排版层次清晰一致
- [ ] 页面布局整洁专业

**✅ 标准四：功能完整（重要标准）**
- [ ] 导航功能正常
- [ ] 图表正确渲染
- [ ] 交互流畅自然

**✅ 标准五：用户体验（加分项）**
- [ ] 加载速度快（<3秒）
- [ ] 动画流畅自然
- [ ] 键盘快捷键支持

---

**📋 最终验收流程：**

```
第一步：内容完整性检验（最重要！）
├─ 提取原文档所有章节标题
├─ 制作章节对照表
├─ 逐项检查是否呈现
└─ ❌ 如有缺失 → 返回步骤1重新分析

第二步：代码质量检验（最重要！）
├─ HTML结构检查
├─ CSS最佳实践检查
├─ JavaScript错误处理检查
├─ 浏览器兼容性测试
└─ ❌ 如有问题 → 返回步骤3重新生成

第三步：设计规范检验
└─ McKinsey风格一致性检查

第四步：功能测试
├─ 导航测试
├─ 图表测试
└─ 交互测试

第五步：签发交付
✅ 所有标准通过 → 可以交付
❌ 任一标准未通过 → 重新执行流程
```

**⚠️ 重要提醒：**

1. **内容完整性 > 设计美观 > 功能炫酷**
   宁可设计简单，不可丢失内容
   宁可功能基础，不可遗漏数据

2. **代码质量 > 创意实现 > 快速完成**
   宁可多花时间，必须保证代码规范
   宁可延迟交付，不可交付有问题的代码

3. **发现问题，立即回退，绝不将就**
   第一个发现的问题就是最严重的问题
   解决第一个问题，可能解决后续所有问题

4. **重新执行时，先解决问题根源**
   内容缺失 → 回到步骤1（分析阶段）
   设计遗漏 → 回到步骤2（设计阶段）
   代码问题 → 回到步骤3（生成阶段）
   合并问题 → 回到步骤4（合并阶段）

**输出产物**：
- 质量检验报告（包含所有检查项结果）
- 发现的问题列表（如有）
- 优化建议（如有）

**验证标准**：
- [ ] 所有检查项通过
- [ ] 无严重问题
- [ ] 无阻塞性缺陷
- [ ] 可以交付使用

---

## 🎯 使用方法

### 基本用法

```
/beauty 文件路径
```

### 多文件处理

```
/beauty 文件1.md 文件2.pdf 文件3.txt
```

### 输出位置

生成的 HTML 文件将保存在原文件同目录下，命名规则：
- `文件.md` → `文件_beautified.html`
- `文件.pdf` → `文件_beautified.html`
- `文件.txt` → `文件_beautified.html`

---

## ⚠️ 重要提醒

1. **必须严格遵循5步流程**：不得跳过任何步骤
2. **内容完整性优先**：宁可多做页面，不可丢失内容
3. **设计规范必遵守**：配色、排版必须符合 McKinsey 标准
4. **质量检验必执行**：必须完成步骤5的所有检查项
5. **用户交付承诺**：确保交付的是可用的专业演示文稿

---

## 📊 支持的文件格式

- **Markdown** (.md) - 推荐
- **Text** (.txt)
- **JSON** (.json) - 结构化数据
- **PDF** (.pdf) - 需要文本提取
- **Word** (.docx) - 需要文本提取

---

## 🎨 McKinsey 设计系统速查

| 元素 | 规范 |
|------|------|
| **背景色** | `#FFFFFF` (纯白) |
| **主文字** | `#000000` (纯黑) |
| **正文文字** | `#333333` (深灰) |
| **强调色** | `#F85d42` (橙色) |
| **辅助色** | `#74788d` (灰蓝) |
| **数据色** | `#556EE6` (深蓝) |
| **成功色** | `#34c38f` (绿色) |
| **警告色** | `#f1b44c` (黄色) |
| **主标题** | 64px, 粗体, 黑色 |
| **副标题** | 28-36px, 粗体, 橙色 |
| **正文** | 16-20px, 常规, 深灰 |
| **行高** | 1.5-1.6 |
| **页面边距** | 60-80px |
| **元素间距** | 20-30px |

---

## 🚀 执行检查清单

在执行 `/beauty` 命令前，确认：

- [ ] 已完整阅读源文档
- [ ] 理解5步流程要求
- [ ] 明确输出目标
- [ ] 准备好进行质量检验

执行后，验证：

- [ ] HTML 文件已生成
- [ ] 文件可正常打开
- [ ] 所有内容完整
- [ ] 所有功能正常
- [ ] 通过质量检验
